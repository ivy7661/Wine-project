import{S as y}from"./sweetalert2.all-hbp0Kpox.js";import{_ as A,m as P,g as m,h as E,c as d,a as e,b as c,w as N,F as S,i as D,k as C,t as h,r as k,o as u,x as p,y as w,B as V,j as x,A as T,L as U,p as L,d as M}from"./index-27vkpBRK.js";import{u as I}from"./user-WPnZOVV0.js";import{_ as j}from"./footerContainer-TBENB7Dp.js";import"./helpers-Hx-ZzB2u.js";var q={VITE_API_URL:"https://wine-project-tmiy.onrender.com",VITE_REPO_NAME:"Wine-project",BASE_URL:"/Wine-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:_}=q,B={name:"CheckoutPage",components:{},data(){return{title:"結帳頁面",cartAll:[],cart:[],userData:{user:{customerEmail:"",customerName:"",customerTel:"",customerAddress:""},payment:{creditCard:"",cardName:"",cardExpiration:"",secureCode:""}},coupon:null,shipping:300,newQty:1,eighteenPlusAgree:!1,privacyAgree:!1,userId:""}},methods:{...P(I,["setUser","cleanUser","getUserCookie"]),getCartList(){const t=`${_}/carts`;m.get(t).then(s=>{this.cartAll=s.data,this.cart=s.data.filter(l=>l.userId===this.userId)}).catch(()=>{})},updateCartQty(t){const s=`${_}/carts`,l={qty:t.qty};t.qty===0?this.deleteCartItem(t):m.patch(`${s}/${t.id}`,l).then(f=>{}).catch(()=>{})},deleteCartItem(t){y.fire({title:"確認刪除？",text:"刪除後將無法恢復！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(s=>{if(s.isConfirmed){const l=`${_}/carts`;m.delete(`${l}/${t.id}`,{userId:this.userId,id:t.id}).then(f=>{this.getCartList(),y.fire({title:"移出購物車",text:"商品已經成功移出購物車",icon:"success"})}).catch(()=>{})}else t.qty=1})},clearCart(){const t=`${_}/carts`;this.cart.forEach(s=>{console.log(s),m.delete(`${t}/${s.id}`).then(()=>{}).catch(l=>{console.error("刪除購物車商品失敗:",l)})})},getFavoriteList(){const t=`${_}/favorite`;m.get(t).then(s=>{this.allFavoriteList=s.data,this.favoriteList=s.data.filter(l=>l.userId===this.userId),this.checkFavoriteStatus()}).catch(()=>{})},checkFavoriteStatus(){this.cart.forEach(t=>{t.isFavorite=this.isProductInFavorite(t.id)})},isProductInFavorite(t){return this.favoriteList.some(s=>s.productId===t)},addToFavorite(t){if(!this.userId){alert("請先登入");return}const s=`${_}/favorite`,l=new Date,f=`${l.getFullYear()}/${(l.getMonth()+1).toString().padStart(2,"0")}/${l.getDate().toString().padStart(2,"0")}`,a={userId:this.userId,productId:t,created_at:f};m.post(s,a).then(n=>{this.getFavoriteList(),y.fire({title:"加入最愛",text:"商品已經成功加入最愛清單。",icon:"success"})}).catch(()=>{})},toggleFavorite(t){this.isProductInFavorite(t.id)?this.removeFromFavorite(t.id):this.addToFavorite(t.id)},removeFromFavorite(t){if(!this.userId){alert("請先登入");return}const s=`${_}/favorite`,l=this.allFavoriteList.findIndex(a=>a.productId===t&&a.userId===this.userId),f=this.allFavoriteList[l].id;m.delete(`${s}/${f}`,{userId:this.userId,id:l}).then(a=>{this.getFavoriteList(),y.fire({title:"移出最愛",text:"商品已經成功移出最愛清單",icon:"success"})}).catch(()=>{})},applyFreeShippingCoupon(){const t=`${_}/coupons`;m.get(t).then(s=>{this.coupon=s.data[0]}).catch(()=>{})},seeProduct(t){this.$router.push({name:"ProductDetail",params:{id:t}})},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼"},isSecurityCode(t){return/^\d{3}$/.test(t)?!0:"需要正確的三位數安全碼"},isCreditCard(t){return/^\d{16}$/.test(t)?!0:"需要正確的信用卡號"},isDateFormat(t){return/^\d{2}\/\d{2}$/.test(t)?!0:"需要正確的日期格式 MM/YY"},createOrder(){const t=`${_}/orders`,s=new Date,l=`${s.getFullYear()}/${(s.getMonth()+1).toString().padStart(2,"0")}/${s.getDate().toString().padStart(2,"0")} ${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`,f={user:{userId:this.userId,name:this.userData.user.customerName,phone:this.userData.user.customerTel,email:this.userData.user.customerEmail,address:this.userData.user.customerAddress},cart:this.cart,is_paid:1,orderStatus:"待出貨",create_at:l};m.post(t,f).then(a=>{this.clearCart(),this.userData={user:{customerEmail:"",customerName:"",customerTel:"",customerAddress:""},payment:{creditCard:"",cardName:"",cardExpiration:"",secureCode:""}},this.toPaymentReceived()}).catch(()=>{y.fire({title:"付款失敗",text:"請稍後再試",icon:"error"})})},toPaymentReceived(){this.$router.push({name:"PaymentReceived"})}},watch:{calculateSubtotal(t){t>=3e3?this.applyFreeShippingCoupon():t<3e3&&(this.coupon=null)}},computed:{...E(I,["getUser"]),calculateSubtotal(){return this.cart.reduce((t,s)=>t+s.price*s.qty,0)},processedShipping(){return this.cart.length>0?this.shipping:0},calculateTotalPrice(){const t=this.calculateSubtotal,s=this.coupon?this.coupon.discount:0;return t+this.processedShipping-s},checkoutAgree(){return this.eighteenPlusAgree&&this.privacyAgree}},mounted(){const{userId:t}=this.getUserCookie();this.userId=t,this.getCartList(),this.getFavoriteList()}},o=t=>(L("data-v-98ee96c7"),t=t(),M(),t),R=o(()=>e("div",{class:"bg-checkout pb-4"},[e("h2",{class:"pb-5 text-white container"},"填寫訂單資訊")],-1)),Y={class:"container pb-5"},O=o(()=>e("img",{src:j,class:"w-100 mb-5"},null,-1)),$=o(()=>e("div",{class:"progress mb-5 fs-5",role:"progressbar","aria-label":"Animated striped example"},[e("div",{class:"progress-bar bg-primary",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 確認購物車 "),e("div",{class:"progress-bar bg-primary progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 填寫資料 "),e("div",{class:"progress-bar bg-secondary",role:"progressbar",style:{width:"34%"},"aria-valuenow":"34","aria-valuemin":"0","aria-valuemax":"100"}," 完成訂單 ")],-1)),Q={class:"row gy-4 flex-column-reverse flex-md-row"},z={class:"col-12 col-md-8"},W=o(()=>e("h4",{class:"pb-4"},"1. 收件者資訊",-1)),H={class:"pb-5"},G={class:"form-floating mb-3"},J=o(()=>e("label",{for:"username"},"姓名",-1)),K={class:"form-floating mb-3"},X=o(()=>e("label",{for:"customerAddress"},"寄送地址",-1)),Z={class:"form-floating mb-3"},ee=o(()=>e("label",{for:"customerTel"},"電話",-1)),te={class:"form-floating mb-3"},se=o(()=>e("label",{for:"customerEmail"},"電子郵件",-1)),ae=o(()=>e("h4",{class:"pb-4"},"2. 付款資訊",-1)),oe={class:"pb-5"},re={class:"form-floating mb-3"},ie=o(()=>e("label",{for:"creditCard"},"卡號",-1)),le={class:"form-floating mb-3"},ce=o(()=>e("label",{for:"cardName"},"持卡人姓名",-1)),ne={class:"form-floating mb-3"},de=o(()=>e("label",{for:"cardExpiration"},"有效日期 (MM/YY)",-1)),ue={class:"form-floating mb-3"},me=o(()=>e("label",{for:"secureCode"},"安全碼",-1)),he={class:"col-12 col-md-4"},pe={class:"totalPrice pb-5"},_e={class:"card fs-5"},fe=o(()=>e("div",{class:"card-header bg-primary fs-5 p-3 ps-4 text-white"},"購物車",-1)),ve={class:"card-body"},ge={class:"d-flex justify-content-between"},be=o(()=>e("p",{class:"card-text"},"商品小計",-1)),ye={class:"card-text"},xe={class:"d-flex justify-content-between"},Ce=o(()=>e("p",{class:"card-text"},"運費價格",-1)),ke={class:"card-text"},we={class:"d-flex justify-content-between"},Se=o(()=>e("p",{class:"card-text"},"優惠卷",-1)),De={key:0,class:"card-text text-danger"},Ve={key:1,class:"card-text"},Ie=o(()=>e("div",{class:"d-flex justify-content-center"},[e("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),Fe={class:"card-body d-flex flex-column justify-content-between"},Ae={class:"d-flex justify-content-between fw-bold"},Pe=o(()=>e("p",{class:"card-text"},"總計",-1)),Ee={class:"card-text text-danger fs-4"},Ne={class:"form-check mb-3"},Te=o(()=>e("label",{class:"form-check-label",for:"eighteenPlusAgree"}," 我已年滿18歲 ",-1)),Ue={class:"form-check"},Le=o(()=>e("label",{class:"form-check-label",for:"privacyAgree"}," 我同意服務及隱私權條款 ",-1)),Me=["disabled"],je={class:"row"},qe={class:"col-12 col-md-8"},Be={class:"cartList d-flex flex-column border border-primary rounded"},Re=o(()=>e("div",{class:"bg-primary fs-5 text-white mb-3 p-3 ps-4"},"訂購清單",-1)),Ye={class:"p-3"},Oe=["onClick"],$e=["onClick"],Qe={class:"card-body d-flex flex-column justify-content-around"},ze={class:"d-flex mb-1 justify-content-between"},We={key:0,class:"badge bg-danger mb-2"},He={class:"d-flex gap-1"},Ge=["onClick"],Je={class:"card-title text-black fs-4"},Ke=o(()=>e("p",null,"750 ml",-1)),Xe={class:"input-group mb-3"},Ze=o(()=>e("span",{class:"input-group-text"},"數量",-1)),et=["onUpdate:modelValue","onClick"],tt={class:"d-flex"},st={class:"text-danger"},at=o(()=>e("div",{class:"d-flex justify-content-center mt-3 mb-5"},[e("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),ot={class:"d-flex flex-column align-items-end pe-3"},rt={key:0,class:"text-primary fs-5"},it={key:1,class:"text-primary fs-5"},lt={class:"text-end mb-1"},ct={class:"fs-4"};function nt(t,s,l,f,a,n){const v=k("VeeField"),g=k("ErrorMessage"),F=k("VeeForm");return u(),d("div",null,[R,e("div",Y,[O,$,c(F,{ref:"checkout-form",onSubmit:n.createOrder},{default:N(({errors:r})=>[e("div",Q,[e("div",z,[W,e("div",H,[e("div",G,[c(v,{id:"customerName",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":r.姓名}]),placeholder:"請輸入名稱",rules:"required|min:2|max:16",modelValue:a.userData.user.customerName,"onUpdate:modelValue":s[0]||(s[0]=i=>a.userData.user.customerName=i)},null,8,["class","modelValue"]),J,c(g,{name:"姓名",class:"invalid-feedback"})]),e("div",K,[c(v,{id:"customerAddress",name:"地址",type:"text",class:p(["form-control",{"is-invalid":r.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:a.userData.user.customerAddress,"onUpdate:modelValue":s[1]||(s[1]=i=>a.userData.user.customerAddress=i)},null,8,["class","modelValue"]),X,c(g,{name:"地址",class:"invalid-feedback"})]),e("div",Z,[c(v,{id:"customerTel",name:"電話",type:"tel",class:p(["form-control",{"is-invalid":r.電話}]),placeholder:"請輸入電話",rules:n.isPhone,modelValue:a.userData.user.customerTel,"onUpdate:modelValue":s[2]||(s[2]=i=>a.userData.user.customerTel=i)},null,8,["class","rules","modelValue"]),ee,c(g,{name:"電話",class:"invalid-feedback"})]),e("div",te,[c(v,{id:"customerEmail",name:"email",type:"email",class:p(["form-control",{"is-invalid":r.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:a.userData.user.customerEmail,"onUpdate:modelValue":s[3]||(s[3]=i=>a.userData.user.customerEmail=i)},null,8,["class","modelValue"]),se,c(g,{name:"email",class:"invalid-feedback"})])]),ae,e("div",oe,[e("div",re,[c(v,{id:"creditCard",name:"信用卡號",type:"text",class:p(["form-control",{"is-invalid":r.信用卡號}]),placeholder:"請輸入信用卡號",rules:n.isCreditCard,modelValue:a.userData.payment.creditCard,"onUpdate:modelValue":s[4]||(s[4]=i=>a.userData.payment.creditCard=i)},null,8,["class","rules","modelValue"]),ie,c(g,{name:"信用卡號",class:"invalid-feedback"})]),e("div",le,[c(v,{id:"cardName",name:"持卡人姓名",type:"text",class:p(["form-control",{"is-invalid":r.持卡人姓名}]),placeholder:"請輸入持卡人姓名",rules:"required|min:2|max:16",modelValue:a.userData.payment.cardName,"onUpdate:modelValue":s[5]||(s[5]=i=>a.userData.payment.cardName=i)},null,8,["class","modelValue"]),ce,c(g,{name:"持卡人姓名",class:"invalid-feedback"})]),e("div",ne,[c(v,{id:"cardExpiration",name:"有效日期",type:"text",class:p(["form-control",{"is-invalid":r.有效日期}]),placeholder:"請輸入有效日期 (MM/YY)",rules:n.isDateFormat,modelValue:a.userData.payment.cardExpiration,"onUpdate:modelValue":s[6]||(s[6]=i=>a.userData.payment.cardExpiration=i)},null,8,["class","rules","modelValue"]),de,c(g,{name:"有效日期",class:"invalid-feedback"})]),e("div",ue,[c(v,{id:"secureCode",name:"安全碼",type:"number",class:p(["form-control",{"is-invalid":r.安全碼}]),placeholder:"請輸入三位數的安全碼",rules:n.isSecurityCode,modelValue:a.userData.payment.secureCode,"onUpdate:modelValue":s[7]||(s[7]=i=>a.userData.payment.secureCode=i)},null,8,["class","rules","modelValue"]),me,c(g,{name:"安全碼",class:"invalid-feedback"})])])]),e("div",he,[e("div",pe,[e("div",_e,[fe,e("div",ve,[e("div",ge,[be,e("p",ye,"NT$ "+h(n.calculateSubtotal),1)]),e("div",xe,[Ce,e("p",ke,"NT$ "+h(n.processedShipping),1)]),e("div",we,[Se,a.coupon?(u(),d("p",De,"- NT$ "+h(a.coupon.discount),1)):(u(),d("p",Ve,"沒有可用的優惠卷"))])]),Ie,e("div",Fe,[e("div",Ae,[Pe,e("p",Ee,"NT$ "+h(n.calculateTotalPrice)+" 元",1)]),e("div",Ne,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[8]||(s[8]=i=>a.eighteenPlusAgree=i),id:"eighteenPlusAgree"},null,512),[[V,a.eighteenPlusAgree]]),Te]),e("div",Ue,[w(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[9]||(s[9]=i=>a.privacyAgree=i),id:"privacyAgree"},null,512),[[V,a.privacyAgree]]),Le])]),e("button",{href:"#",type:"submit",class:"btn bg-primary-low fs-5 text-white py-3",disabled:!n.checkoutAgree}," 確認完成並付款 ",8,Me)])])])])]),_:1},8,["onSubmit"]),e("div",je,[e("div",qe,[e("div",Be,[Re,e("div",Ye,[(u(!0),d(S,null,D(a.cart,(r,i)=>(u(),d("div",{class:"card shadow d-flex flex-row justify-content-between mb-3 fs-4 pe-3",key:i},[e("a",{href:"#",onClick:x(b=>n.toggleFavorite(r),["prevent"])},[e("i",{class:p(["bi heart position-absolute top-5 start-5",{"bi-heart":!r.isFavorite,"bi-heart-fill":r.isFavorite}])},null,2)],8,Oe),e("a",{href:"#",onClick:x(b=>n.seeProduct(r.product_id),["prevent"]),class:"wine_image_block"},[e("div",{class:"wine_image",style:T(t.$filters.imgPath({"background-image":"url(/images/wine_images/"+r.image+".jpg)"}))},null,4)],8,$e),e("div",Qe,[e("div",ze,[r.is_hot?(u(),d("span",We,"熱門推薦")):C("",!0),e("div",He,[(u(!0),d(S,null,D(r.star,b=>(u(),d("i",{class:"bi bi-star-fill text-warning",key:b}))),128))])]),e("a",{href:"#",onClick:x(b=>n.seeProduct(r.id),["prevent"])},[e("h5",Je,h(r.chineseName),1)],8,Ge),Ke,e("div",Xe,[Ze,w(e("input",{type:"number",min:"0",class:"form-control text-end","onUpdate:modelValue":b=>r.qty=b,onClick:x(b=>n.updateCartQty(r),["prevent"])},null,8,et),[[U,r.qty,void 0,{number:!0}]])]),e("div",tt,[e("p",st,"$ "+h(r.price),1)])])]))),128))]),at,e("div",ot,[a.coupon?(u(),d("p",rt,"太棒了！訂單滿3000元，獲得免運卷！")):C("",!0),a.coupon?C("",!0):(u(),d("p",it," 再 "+h(3e3-n.calculateSubtotal)+" 元即可獲得免運唷！ ",1)),e("div",null,[e("p",lt,"(共 "+h(a.cart.length)+" 件商品)",1),e("p",ct,"小計: NT$ "+h(n.calculateSubtotal)+" 元",1)])])])])])])])}const _t=A(B,[["render",nt],["__scopeId","data-v-98ee96c7"]]);export{_t as default};
