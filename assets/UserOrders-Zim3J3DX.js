import{_ as x,g as $,o as a,c as r,a as t,t as l,F as _,j as v,k as w,y,O as k,x as M,M as O,i as L,p as C,e as P,m as D,b as f,w as N,r as b}from"./index-_sTTT7DT.js";import{S as m}from"./sweetalert2.all-bhEUQfIR.js";import{W as S}from"./WineGlassLoader-JAov3T_a.js";import{u as T}from"./user-OqEc5-va.js";import{M as j}from"./bootstrap.esm-TTjMTX3M.js";import{_ as B}from"./footerContainer-TBENB7Dp.js";import"./helpers-Hx-ZzB2u.js";const U={props:["cartProduct","userData","orderId"],data(){return{tempCartProducts:null,user:{userId:0,name:""}}},watch:{cartProduct(){this.tempCartProducts=this.cartProduct.map(e=>({...e,isCommentRate:e.isCommentRate||!1,comment:e.comment||"",rate:e.rate||5}))},userData(){this.user={...this.userData}}},methods:{openModal(){this.modalProduct.show()},closeModal(){this.modalProduct.hide()},seeProduct(e){this.closeModal(),setTimeout(()=>{this.$router.push({name:"ProductDetail",params:{id:e}})},0)},updateOrder(){const e=`https://wine-project-tmiy.onrender.com/orders/${this.orderId}`,o={cart:this.tempCartProducts};$.patch(e,o).then(d=>{m.fire({title:"商品評論",text:"商品已經成功評論。",icon:"success"})}).catch(d=>{console.error("updateOrder",d),m.fire({title:"商品評論",text:"商品評論失敗",icon:"error"})})},addComment(e){const o="https://wine-project-tmiy.onrender.com/comments",d={ordersId:this.orderId,productId:e.id,chineseName:e.chineseName,comment:e.comment,rate:e.rate,userId:this.user.userId,userName:this.user.name};$.post(o,d).then(u=>{e.isCommentRate=!0,this.updateOrder()}).catch(u=>{console.error("addComment",u),m.fire({title:"商品評論",text:"商品評論失敗!",icon:"error"})})}},mounted(){this.modalProduct=new j(this.$refs.productModal)}},g=e=>(C("data-v-1250b24f"),e=e(),P(),e),V={ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"selectProductModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-xl"},F={class:"modal-content border-0"},W={class:"modal-header bg-dark text-white"},G={id:"selectProductModalLabel",class:"modal-title"},Z=g(()=>t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),q={class:"modal-body"},z={class:"row"},A={class:"card h-100 p-2"},E={class:"row h-100"},H={class:"col-4"},J=["onClick"],K=["src","alt"],Q={class:"col-8"},X={class:"card-body d-flex flex-column h-100 justify-content-between"},Y={class:"mb-2"},tt={class:"card-title flex-fill"},et={class:"card-text text-danger fw-bold"},st={class:"mt-3 mb-2"},ot=["for"],at={class:"rating-container"},rt=["id","value","onUpdate:modelValue","disabled"],dt=["for"],it=g(()=>t("svg",{id:"Object",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1122 1122"},[t("path",{class:"cls-2",d:"m570.497,252.536l93.771,190c1.543,3.126,4.525,5.292,7.974,5.794l209.678,30.468c8.687,1.262,12.156,11.938,5.87,18.065l-151.724,147.895c-2.496,2.433-3.635,5.939-3.046,9.374l35.817,208.831c1.484,8.652-7.597,15.25-15.367,11.165l-187.542-98.596c-3.085-1.622-6.771-1.622-9.857,0l-187.542,98.596c-7.77,4.085-16.851-2.513-15.367-11.165l35.817-208.831c.589-3.436-.55-6.941-3.046-9.374l-151.724-147.895c-6.286-6.127-2.817-16.803,5.87-18.065l209.678-30.468c3.45-.501,6.432-2.668,7.974-5.794l93.771-190c3.885-7.872,15.11-7.872,18.995,0Z"}),t("path",{class:"cls-1",d:"m561,296.423l-83.563,161.857c-4.383,8.49-12.797,14.155-22.312,15.024l-181.433,16.562,191.688,8.964c12.175.569,23.317-6.81,27.543-18.243l68.077-184.164Z"}),t("path",{class:"cls-3",d:"m357.284,838.933l-4.121,24.03c-1.484,8.652,7.597,15.25,15.367,11.165l187.541-98.596c3.086-1.622,6.771-1.622,9.857,0l187.541,98.596c7.77,4.085,16.851-2.513,15.367-11.165l-35.817-208.831c-.589-3.435.55-6.941,3.046-9.374l151.724-147.894c6.287-6.127,2.818-16.802-5.87-18.065l-70.23-10.205c-113.59,203.853-287.527,311.181-454.405,370.34Z"})],-1)),nt=[it],ct={class:"mb-3"},lt=["for"],mt=["id","disabled","onUpdate:modelValue"],ht=["onClick","disabled"],_t={key:0},ut={key:1},pt=g(()=>t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 關閉 ")],-1));function ft(e,o,d,u,n,h){return a(),r("div",V,[t("div",R,[t("div",F,[t("div",W,[t("h5",G,[t("span",null,"訂單編號 : "+l(d.orderId),1)]),Z]),t("div",q,[t("div",z,[(a(!0),r(_,null,v(n.tempCartProducts,s=>(a(),r("div",{class:"col-12 col-md-6 col-lg-6 mb-3",key:s.id},[t("div",A,[t("div",E,[t("div",H,[t("a",{href:"#",onClick:w(i=>h.seeProduct(s.id),["prevent"])},[t("img",{src:e.$filters.imgPath(`/images/wine_images/${s.image}.jpg`),class:"card-img-top",alt:s.chineseName},null,8,K)],8,J)]),t("div",Q,[t("div",X,[t("div",Y,[t("div",null,[t("h5",tt,l(s.chineseName),1),t("p",et," 單價 ： NT $"+l(e.$filters.currency(s.price))+" * "+l(s.qty),1)])]),t("div",st,[t("label",{for:`comment-${s.id}`},"商品評價:",8,ot),t("fieldset",at,[(a(),r(_,null,v(5,i=>(a(),r(_,{key:`start-${i}`},[y(t("input",{type:"radio",name:"rating",id:`rate-${i}-${s.id}`,value:6-i,"onUpdate:modelValue":p=>s.rate=p,disabled:s.isCommentRate},null,8,rt),[[k,s.rate]]),t("label",{class:M({"is-rate":s.rate>=6-i}),for:`rate-${i}-${s.id}`},nt,10,dt)],64))),64))])]),t("div",ct,[t("label",{for:`comment-${s.id}`},"商品評論:",8,lt),y(t("textarea",{id:`comment-${s.id}`,rows:"6",maxlength:"100",disabled:s.isCommentRate,"onUpdate:modelValue":i=>s.comment=i},null,8,mt),[[O,s.comment]])]),s.isCommentRate?L("",!0):(a(),r("button",{key:0,class:"btn btn-primary w-100",onClick:w(i=>h.addComment(s),["prevent"]),disabled:!s.comment},[s.comment?(a(),r("span",ut,"新增評論")):(a(),r("span",_t,"請先新增評論"))],8,ht))])])])])]))),128))])]),pt])])],512)}const bt=x(U,[["render",ft],["__scopeId","data-v-1250b24f"]]),$t={name:"UserOrders",components:{OrderProductModal:bt,WineGlassLoader:S},data(){return{title:"會員訂單",isLoading:!0,orders:[],cartProduct:[],userData:{},tmpOrderId:0,userId:0}},mounted(){const{userToken:e,userId:o}=this.getUserCookie();e&&o?(this.userId=o,this.getOrders()):this.$router.push("/login")},methods:{...D(T,["getUserCookie"]),getOrders(){if(!this.userId)return;const e=`https://wine-project-tmiy.onrender.com/orders?userId=${this.userId}`;this.$http.get(e).then(o=>{this.orders=o.data}).catch(o=>{console.log(o.response)}).finally(()=>{setTimeout(()=>{this.isLoading=!1},500)})},comment(e){!this.userId||!(e!=null&&e.id)||m.fire({title:"確認移除收藏嗎?",text:`商品: ${e.product.chineseName}`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonText:"取消"}).then(o=>{o.isConfirmed&&$.delete(`https://wine-project-tmiy.onrender.com/favorite/${e.id}`).then(d=>{this.getFavoriteList(),this.resetUserFavorites(),m.fire({title:"刪除成功",text:"",icon:"success"})}).catch(d=>{console.log(d.response),m.fire({title:"收藏失敗",text:"",icon:"error"})})})},openModal(e){this.cartProduct=e.cart,this.tmpOrderId=e.id,this.userData=e.user,this.$refs.orderProductModal.openModal()},catTotalPrice(e){return e.reduce((o,d)=>o+d.price*d.qty,0)}}},I=e=>(C("data-v-405e6306"),e=e(),P(),e),vt={class:"container mb-5"},gt={class:"row"},wt={class:"d-flex justify-content-between align-items-end mt-3"},yt={class:"mt-5 mb-1 fs-3 font-weight-normal fw-bold"},xt=I(()=>t("img",{src:B,class:"w-100 mt-5 mb-3"},null,-1)),Ct={class:"col-12"},Pt={class:"table order-table mt-4 mx-2"},It=I(()=>t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"120"},"訂單日期"),t("th",{width:"120"},"訂單編號"),t("th",{width:"120"},"付款狀態"),t("th",{width:"150"},"訂單狀態"),t("th",{width:"120"},"訂單金額"),t("th",{width:"120",class:"text-center"})])],-1)),kt={key:0,class:"text-success"},Mt={key:1},Ot={key:0,class:"text-success"},Lt={key:1},Dt={key:2},Nt={class:"text-right"},St={class:"text-center"},Tt=["onClick"];function jt(e,o,d,u,n,h){const s=b("WineGlassLoader"),i=b("VueLoading"),p=b("OrderProductModal");return a(),r(_,null,[f(i,{active:n.isLoading},{default:N(()=>[f(s)]),_:1},8,["active"]),t("div",vt,[t("div",gt,[t("div",wt,[t("h2",yt,"會員 / "+l(n.title),1)]),xt,t("div",Ct,[t("table",Pt,[It,t("tbody",null,[(a(!0),r(_,null,v(n.orders,c=>(a(),r("tr",{key:c.id},[t("td",null,l(c.create_at),1),t("td",null,l(c.id),1),t("td",null,[c.is_paid?(a(),r("span",kt,"已付款")):(a(),r("span",Mt,"未付款"))]),t("td",null,[c.orderStatus==="訂單已完成"?(a(),r("span",Ot,"訂單已完成")):c.orderStatus==="訂單已成立"?(a(),r("span",Lt,"訂單已成立")):(a(),r("span",Dt,"配送中"))]),t("td",Nt," NT $"+l(e.$filters.currency(h.catTotalPrice(c.cart))),1),t("td",St,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:Bt=>h.openModal(c)}," 查看/評論 ",8,Tt)])]))),128))])])])])]),f(p,{ref:"orderProductModal",cartProduct:n.cartProduct,userData:n.userData,orderId:n.tmpOrderId},null,8,["cartProduct","userData","orderId"])],64)}const qt=x($t,[["render",jt],["__scopeId","data-v-405e6306"]]);export{qt as default};
