import{S as x}from"./sweetalert2.all-rOmComfA.js";import{_ as w,m as A,g as v,h as E,c as d,a as e,b as c,w as N,F as S,i as D,k as y,t as m,r as k,o as u,x as h,y as C,B as V,A as P,L as T,p as U,d as L}from"./index-6puxszkb.js";import{u as I}from"./user-rKheNwX1.js";import{_ as M}from"./footerContainer-g7u_3nq6.js";import"./helpers-Hx-ZzB2u.js";var j={VITE_API_URL:"https://wine-project-tmiy.onrender.com",VITE_REPO_NAME:"Wine-project",BASE_URL:"/undefined/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:g}=j,q={name:"CheckoutPage",components:{},data(){return{title:"購物車",cartAll:[],cart:[],userData:{user:{customerEmail:"",customerName:"",customerTel:"",customerAddress:""},payment:{creditCard:"",cardName:"",cardExpiration:"",secureCode:""}},coupon:null,shipping:300,newQty:1,eighteenPlusAgree:!1,privacyAgree:!1,userId:""}},methods:{...A(I,["setUser","cleanUser","getUserCookie"]),getCartList(){const t=`${g}/carts`;v.get(t).then(s=>{this.cartAll=s.data,this.cart=s.data.filter(l=>l.userId===this.userId)}).catch(()=>{})},updateCartQty(t){const s=`${g}/carts`,l={qty:t.qty};t.qty===0?this.deleteCartItem(t):v.patch(`${s}/${t.id}`,l).then(_=>{}).catch(()=>{})},deleteCartItem(t){x.fire({title:"確認刪除？",text:"刪除後將無法恢復！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(s=>{if(s.isConfirmed){const l=`${g}/carts`;v.delete(`${l}/${t.id}`,{userId:this.userId,id:t.id}).then(_=>{this.getCartList(),x.fire({title:"移出購物車",text:"商品已經成功移出購物車",icon:"success"})}).catch(()=>{})}else t.qty=1})},getFavoriteList(){const t=`${g}/favorite`;v.get(t).then(s=>{this.allFavoriteList=s.data,this.favoriteList=s.data.filter(l=>l.userId===this.userId),this.checkFavoriteStatus()}).catch(()=>{})},checkFavoriteStatus(){this.cart.forEach(t=>{t.isFavorite=this.isProductInFavorite(t.id)})},isProductInFavorite(t){return this.favoriteList.some(s=>s.productId===t)},addToFavorite(t){if(!this.userId){alert("請先登入");return}const s=`${g}/favorite`,l=new Date,_=`${l.getFullYear()}/${(l.getMonth()+1).toString().padStart(2,"0")}/${l.getDate().toString().padStart(2,"0")}`,o={userId:this.userId,productId:t,created_at:_};v.post(s,o).then(n=>{this.getFavoriteList(),x.fire({title:"加入最愛",text:"商品已經成功加入最愛清單。",icon:"success"})}).catch(()=>{})},toggleFavorite(t){this.isProductInFavorite(t.id)?this.removeFromFavorite(t.id):this.addToFavorite(t.id)},removeFromFavorite(t){if(!this.userId){alert("請先登入");return}const s=`${g}/favorite`,l=this.allFavoriteList.findIndex(o=>o.productId===t&&o.userId===this.userId),_=this.allFavoriteList[l].id;v.delete(`${s}/${_}`,{userId:this.userId,id:l}).then(o=>{this.getFavoriteList(),x.fire({title:"移出最愛",text:"商品已經成功移出最愛清單",icon:"success"})}).catch(()=>{})},applyFreeShippingCoupon(){const t=`${g}/coupons`;v.get(t).then(s=>{this.coupon=s.data[0]}).catch(()=>{})},seeProduct(t){this.$router.push({name:"ProductDetail",params:{id:t}})},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼"},isSecurityCode(t){return/^\d{3}$/.test(t)?!0:"需要正確的三位數安全碼"},isCreditCard(t){return/^\d{16}$/.test(t)?!0:"需要正確的信用卡號"},isDateFormat(t){return/^\d{2}\/\d{2}$/.test(t)?!0:"需要正確的日期格式 MM/YY"},createOrder(){const t=`${g}/orders`,s=new Date,l=`${s.getFullYear()}/${(s.getMonth()+1).toString().padStart(2,"0")}/${s.getDate().toString().padStart(2,"0")} ${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`,_={user:{userId:this.userId,name:this.userData.user.customerName,phone:this.userData.user.customerTel,email:this.userData.user.customerEmail,address:this.userData.user.customerAddress},cart:this.cart,is_paid:1,orderStatus:"配送中",create_at:l};v.post(t,_).then(o=>{x.fire({title:"訂單已完成",text:"感謝您的購物，請查看您的電子郵件以獲取訂單狀態。",icon:"success"}),this.userData={user:{customerEmail:"",customerName:"",customerTel:"",customerAddress:""},payment:{creditCard:"",cardName:"",cardExpiration:"",secureCode:""}}}).catch(()=>{x.fire({title:"付款失敗",text:"請稍後再試",icon:"error"})})}},watch:{calculateSubtotal(t){t>=3e3?this.applyFreeShippingCoupon():t<3e3&&(this.coupon=null)}},computed:{...E(I,["getUser"]),calculateSubtotal(){return this.cart.reduce((t,s)=>t+s.price*s.qty,0)},processedShipping(){return this.cart.length>0?this.shipping:0},calculateTotalPrice(){const t=this.calculateSubtotal,s=this.coupon?this.coupon.discount:0;return t+this.processedShipping-s},checkoutAgree(){return this.eighteenPlusAgree&&this.privacyAgree}},mounted(){const{userId:t}=this.getUserCookie();this.userId=t,this.getCartList(),this.getFavoriteList()}},a=t=>(U("data-v-c5c77959"),t=t(),L(),t),B=a(()=>e("div",{class:"bg-checkout pb-4"},[e("h2",{class:"pb-5 text-white container"},"填寫訂單資訊")],-1)),Y={class:"container pb-5"},R=a(()=>e("img",{src:M,class:"w-100 mb-5"},null,-1)),O={class:"row gy-4 flex-column-reverse flex-md-row"},Q={class:"col-12 col-md-8"},z=a(()=>e("h4",{class:"pb-4"},"1. 收件者資訊",-1)),H={class:"pb-5"},W={class:"form-floating mb-3"},G=a(()=>e("label",{for:"username"},"姓名",-1)),J={class:"form-floating mb-3"},K=a(()=>e("label",{for:"customerAddress"},"寄送地址",-1)),X={class:"form-floating mb-3"},Z=a(()=>e("label",{for:"customerTel"},"電話",-1)),$={class:"form-floating mb-3"},ee=a(()=>e("label",{for:"customerEmail"},"電子郵件",-1)),te=a(()=>e("h4",{class:"pb-4"},"2. 付款資訊",-1)),se={class:"pb-5"},oe={class:"form-floating mb-3"},ae=a(()=>e("label",{for:"creditCard"},"卡號",-1)),ie={class:"form-floating mb-3"},re=a(()=>e("label",{for:"cardName"},"持卡人姓名",-1)),le={class:"form-floating mb-3"},ce=a(()=>e("label",{for:"cardExpiration"},"有效日期 (MM/YY)",-1)),ne={class:"form-floating mb-3"},de=a(()=>e("label",{for:"secureCode"},"安全碼",-1)),ue={class:"col-12 col-md-4"},me={class:"totalPrice pb-5"},he={class:"card fs-5"},_e=a(()=>e("div",{class:"card-header bg-primary fs-5 p-3 ps-4 text-white"},"購物車",-1)),pe={class:"card-body"},fe={class:"d-flex justify-content-between"},ve=a(()=>e("p",{class:"card-text"},"商品小計",-1)),ge={class:"card-text"},be={class:"d-flex justify-content-between"},xe=a(()=>e("p",{class:"card-text"},"運費價格",-1)),ye={class:"card-text"},ke={class:"d-flex justify-content-between"},Ce=a(()=>e("p",{class:"card-text"},"優惠卷",-1)),Se={key:0,class:"card-text text-danger"},De={key:1,class:"card-text"},Ve=a(()=>e("div",{class:"d-flex justify-content-center"},[e("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),Ie={class:"card-body d-flex flex-column justify-content-between"},Fe={class:"d-flex justify-content-between fw-bold"},we=a(()=>e("p",{class:"card-text"},"總計",-1)),Ae={class:"card-text text-danger fs-4"},Ee={class:"form-check mb-3"},Ne=a(()=>e("label",{class:"form-check-label",for:"eighteenPlusAgree"}," 我已年滿18歲 ",-1)),Pe={class:"form-check"},Te=a(()=>e("label",{class:"form-check-label",for:"privacyAgree"}," 我同意服務及隱私權條款 ",-1)),Ue=["disabled"],Le={class:"row"},Me={class:"col-12 col-md-8"},je={class:"cartList d-flex flex-column border border-primary rounded"},qe=a(()=>e("div",{class:"bg-primary fs-5 text-white mb-3 p-3 ps-4"},"訂購清單",-1)),Be={class:"p-3"},Ye=["onClick"],Re=["onClick"],Oe={class:"card-body d-flex flex-column justify-content-around"},Qe={class:"d-flex mb-1 justify-content-between"},ze={key:0,class:"badge bg-danger mb-2"},He={class:"d-flex gap-1"},We=["onClick"],Ge={class:"card-title text-black fs-4"},Je=a(()=>e("p",null,"750 ml",-1)),Ke={class:"input-group mb-3"},Xe=a(()=>e("span",{class:"input-group-text"},"數量",-1)),Ze=["onUpdate:modelValue","onClick"],$e={class:"d-flex"},et={class:"text-danger"},tt=a(()=>e("div",{class:"d-flex justify-content-center mt-3 mb-5"},[e("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),st={class:"d-flex flex-column align-items-end pe-3"},ot={key:0,class:"text-primary fs-5"},at={key:1,class:"text-primary fs-5"},it={class:"text-end mb-1"},rt={class:"fs-4"};function lt(t,s,l,_,o,n){const p=k("VeeField"),f=k("ErrorMessage"),F=k("VeeForm");return u(),d("div",null,[B,e("div",Y,[R,c(F,{ref:"checkout-form",onSubmit:n.createOrder},{default:N(({errors:i})=>[e("div",O,[e("div",Q,[z,e("div",H,[e("div",W,[c(p,{id:"customerName",name:"姓名",type:"text",class:h(["form-control",{"is-invalid":i.姓名}]),placeholder:"請輸入名稱",rules:"required|min:2|max:16",modelValue:o.userData.user.customerName,"onUpdate:modelValue":s[0]||(s[0]=r=>o.userData.user.customerName=r)},null,8,["class","modelValue"]),G,c(f,{name:"姓名",class:"invalid-feedback"})]),e("div",J,[c(p,{id:"customerAddress",name:"地址",type:"text",class:h(["form-control",{"is-invalid":i.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.userData.user.customerAddress,"onUpdate:modelValue":s[1]||(s[1]=r=>o.userData.user.customerAddress=r)},null,8,["class","modelValue"]),K,c(f,{name:"地址",class:"invalid-feedback"})]),e("div",X,[c(p,{id:"customerTel",name:"電話",type:"tel",class:h(["form-control",{"is-invalid":i.電話}]),placeholder:"請輸入電話",rules:n.isPhone,modelValue:o.userData.user.customerTel,"onUpdate:modelValue":s[2]||(s[2]=r=>o.userData.user.customerTel=r)},null,8,["class","rules","modelValue"]),Z,c(f,{name:"電話",class:"invalid-feedback"})]),e("div",$,[c(p,{id:"customerEmail",name:"email",type:"email",class:h(["form-control",{"is-invalid":i.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.userData.user.customerEmail,"onUpdate:modelValue":s[3]||(s[3]=r=>o.userData.user.customerEmail=r)},null,8,["class","modelValue"]),ee,c(f,{name:"email",class:"invalid-feedback"})])]),te,e("div",se,[e("div",oe,[c(p,{id:"creditCard",name:"信用卡號",type:"text",class:h(["form-control",{"is-invalid":i.信用卡號}]),placeholder:"請輸入信用卡號",rules:n.isCreditCard,modelValue:o.userData.payment.creditCard,"onUpdate:modelValue":s[4]||(s[4]=r=>o.userData.payment.creditCard=r)},null,8,["class","rules","modelValue"]),ae,c(f,{name:"信用卡號",class:"invalid-feedback"})]),e("div",ie,[c(p,{id:"cardName",name:"持卡人姓名",type:"text",class:h(["form-control",{"is-invalid":i.持卡人姓名}]),placeholder:"請輸入持卡人姓名",rules:"required|min:2|max:16",modelValue:o.userData.payment.cardName,"onUpdate:modelValue":s[5]||(s[5]=r=>o.userData.payment.cardName=r)},null,8,["class","modelValue"]),re,c(f,{name:"持卡人姓名",class:"invalid-feedback"})]),e("div",le,[c(p,{id:"cardExpiration",name:"有效日期",type:"text",class:h(["form-control",{"is-invalid":i.有效日期}]),placeholder:"請輸入有效日期 (MM/YY)",rules:n.isDateFormat,modelValue:o.userData.payment.cardExpiration,"onUpdate:modelValue":s[6]||(s[6]=r=>o.userData.payment.cardExpiration=r)},null,8,["class","rules","modelValue"]),ce,c(f,{name:"有效日期",class:"invalid-feedback"})]),e("div",ne,[c(p,{id:"secureCode",name:"安全碼",type:"number",class:h(["form-control",{"is-invalid":i.安全碼}]),placeholder:"請輸入三位數的安全碼",rules:n.isSecurityCode,modelValue:o.userData.payment.secureCode,"onUpdate:modelValue":s[7]||(s[7]=r=>o.userData.payment.secureCode=r)},null,8,["class","rules","modelValue"]),de,c(f,{name:"安全碼",class:"invalid-feedback"})])])]),e("div",ue,[e("div",me,[e("div",he,[_e,e("div",pe,[e("div",fe,[ve,e("p",ge,"NT$ "+m(n.calculateSubtotal),1)]),e("div",be,[xe,e("p",ye,"NT$ "+m(n.processedShipping),1)]),e("div",ke,[Ce,o.coupon?(u(),d("p",Se,"- NT$ "+m(o.coupon.discount),1)):(u(),d("p",De,"沒有可用的優惠卷"))])]),Ve,e("div",Ie,[e("div",Fe,[we,e("p",Ae,"NT$ "+m(n.calculateTotalPrice)+" 元",1)]),e("div",Ee,[C(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[8]||(s[8]=r=>o.eighteenPlusAgree=r),id:"eighteenPlusAgree"},null,512),[[V,o.eighteenPlusAgree]]),Ne]),e("div",Pe,[C(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[9]||(s[9]=r=>o.privacyAgree=r),id:"privacyAgree"},null,512),[[V,o.privacyAgree]]),Te])]),e("button",{href:"#",type:"submit",class:"btn bg-primary-low fs-5 text-white py-3",disabled:!n.checkoutAgree}," 確認完成並付款 ",8,Ue)])])])])]),_:1},8,["onSubmit"]),e("div",Le,[e("div",Me,[e("div",je,[qe,e("div",Be,[(u(!0),d(S,null,D(o.cart,(i,r)=>(u(),d("div",{class:"card shadow d-flex flex-row justify-content-between mb-3 fs-4 pe-3",key:r},[e("a",{href:"#",onClick:b=>n.toggleFavorite(i)},[e("i",{class:h(["bi heart position-absolute top-5 start-5",{"bi-heart":!i.isFavorite,"bi-heart-fill":i.isFavorite}])},null,2)],8,Ye),e("a",{href:"#",onClick:b=>n.seeProduct(i.product_id),class:"wine_image_block"},[e("div",{class:"wine_image",style:P({"background-image":"url(/images/wine_images/"+i.image+".jpg)"})},null,4)],8,Re),e("div",Oe,[e("div",Qe,[i.is_hot?(u(),d("span",ze,"熱門推薦")):y("",!0),e("div",He,[(u(!0),d(S,null,D(i.star,b=>(u(),d("i",{class:"bi bi-star-fill text-warning",key:b}))),128))])]),e("a",{href:"#",onClick:b=>n.seeProduct(i.id)},[e("h5",Ge,m(i.chineseName),1)],8,We),Je,e("div",Ke,[Xe,C(e("input",{type:"number",min:"0",class:"form-control text-end","onUpdate:modelValue":b=>i.qty=b,onClick:b=>n.updateCartQty(i)},null,8,Ze),[[T,i.qty,void 0,{number:!0}]])]),e("div",$e,[e("p",et,"$ "+m(i.price),1)])])]))),128))]),tt,e("div",st,[o.coupon?(u(),d("p",ot,"太棒了！訂單滿3000元，獲得免運卷！")):y("",!0),o.coupon?y("",!0):(u(),d("p",at," 再 "+m(3e3-n.calculateSubtotal)+" 元即可獲得免運唷！ ",1)),e("div",null,[e("p",it,"(共 "+m(o.cart.length)+" 件商品)",1),e("p",rt,"小計: NT$ "+m(n.calculateSubtotal)+" 元",1)])])])])])])])}const ht=w(q,[["render",lt],["__scopeId","data-v-c5c77959"]]);export{ht as default};
