import{S as g}from"./sweetalert2.all-z-9cJw1m.js";import{_ as F,L,m as A,I as E,g as d,h as P,c as b,b as i,w as x,a as t,r as _,o as y,y as u,t as v,z as C,C as D,p as T,e as U}from"./index-6PzzfaJ8.js";import{u as I}from"./user-qX7th_-E.js";/* empty css              */import{W as S}from"./WineGlassLoader-yM45y1Ob.js";import{_ as N}from"./footerContainer-TBENB7Dp.js";import"./helpers-Hx-ZzB2u.js";var M={VITE_API_URL:"https://wine-project-tmiy.onrender.com",VITE_REPO_NAME:"Wine-project",BASE_URL:"/Wine-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:m}=M,q={name:"CheckoutPage",data(){return{title:"結帳頁面",cartAll:[],cart:[],userData:{user:{customerEmail:"",customerName:"",customerTel:"",customerAddress:""},payment:{creditCard:"",cardName:"",cardExpiration:"",secureCode:""}},quantityOptions:[0,1,2,3,4,5,6,7,8],coupon:null,shipping:300,newQty:1,eighteenPlusAgree:!1,privacyAgree:!1,userId:"",isLoading:!1,fullPage:!0}},components:{Loading:L,WineGlassLoader:S},methods:{...A(I,["setUser","cleanUser","getUserCookie","resetUserCarts"]),doLoading(){this.$loading.show({props:{spinner:S},container:this.$refs.loadingContainer,canCancel:!0,color:"#000000",loader:"spinner",width:64,height:64,backgroundColor:"#ffffff",opacity:.5,zIndex:999},{default:E("WineGlassLoader")}).hide()},setLoadingTime(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},800)},getCartList(){const e=`${m}/carts`;d.get(e).then(s=>{this.setLoadingTime(),this.cartAll=s.data,this.cart=s.data.filter(l=>l.userId===this.userId)}).catch(()=>{})},updateCartQty(e){const s=`${m}/carts`,l={qty:e.qty};e.qty===0?this.deleteCartItem(e):d.patch(`${s}/${e.id}`,l).then(h=>{this.resetUserCarts()}).catch(()=>{})},deleteCartItem(e){g.fire({title:"確認刪除？",text:"刪除後將無法恢復！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(s=>{if(s.isConfirmed){const l=`${m}/carts`;d.delete(`${l}/${e.id}`,{userId:this.userId,id:e.id}).then(h=>{this.resetUserCarts(),this.getCartList(),g.fire({title:"移出購物車",text:"商品已經成功移出購物車",icon:"success"})}).catch(()=>{})}else e.qty=1})},clearCart(){const e=`${m}/carts`;this.cart.forEach(s=>{d.delete(`${e}/${s.id}`).then(()=>{this.resetUserCarts()}).catch(()=>{})})},getFavoriteList(){const e=`${m}/favorite`;d.get(e).then(s=>{this.allFavoriteList=s.data,this.favoriteList=s.data.filter(l=>l.userId===this.userId),this.checkFavoriteStatus()}).catch(()=>{})},checkFavoriteStatus(){this.cart.forEach(e=>{e.isFavorite=this.isProductInFavorite(e.id)})},isProductInFavorite(e){return this.favoriteList.some(s=>s.productId===e)},addToFavorite(e){const s=`${m}/favorite`,l=new Date,h=`${l.getFullYear()}/${(l.getMonth()+1).toString().padStart(2,"0")}/${l.getDate().toString().padStart(2,"0")}`,a={userId:this.userId,productId:e,created_at:h};d.post(s,a).then(c=>{this.getFavoriteList(),g.fire({title:"加入最愛",text:"商品已經成功加入最愛清單。",icon:"success"})}).catch(()=>{})},toggleFavorite(e){this.isProductInFavorite(e.id)?this.removeFromFavorite(e.id):this.addToFavorite(e.id)},removeFromFavorite(e){const s=`${m}/favorite`,l=this.allFavoriteList.findIndex(a=>a.productId===e&&a.userId===this.userId),h=this.allFavoriteList[l].id;d.delete(`${s}/${h}`,{userId:this.userId,id:l}).then(a=>{this.getFavoriteList()}).catch(()=>{})},applyFreeShippingCoupon(){const e=`${m}/coupons`;d.get(e).then(s=>{this.coupon=s.data[0]}).catch(()=>{})},seeProduct(e){this.$router.push({name:"ProductDetail",params:{id:e}})},isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"需要正確的電話號碼"},isSecurityCode(e){return/^\d{3}$/.test(e)?!0:"需要正確的三位數安全碼"},isCreditCard(e){return/^\d{16}$/.test(e)?!0:"需要正確的信用卡號"},isDateFormat(e){return/^\d{2}\d{2}$/.test(e)?!0:"需要正確的日期格式 MMYY"},createOrder(){const e=`${m}/orders`,s=new Date,l=`${s.getFullYear()}/${(s.getMonth()+1).toString().padStart(2,"0")}/${s.getDate().toString().padStart(2,"0")} ${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`,h={userId:this.userId,user:{userId:this.userId,name:this.userData.user.customerName,phone:this.userData.user.customerTel,email:this.userData.user.customerEmail,address:this.userData.user.customerAddress},cart:this.cart,is_paid:1,orderStatus:"訂單已成立",create_at:l};d.post(e,h).then(a=>{this.clearCart(),this.userData={user:{customerEmail:"",customerName:"",customerTel:"",customerAddress:""},payment:{creditCard:"",cardName:"",cardExpiration:"",secureCode:""}},this.toPaymentReceived()}).catch(()=>{g.fire({title:"付款失敗",text:"請稍後再試",icon:"error"})})},toPaymentReceived(){this.$router.push({name:"PaymentReceived"})}},watch:{calculateSubtotal(e){e>=3e3?this.applyFreeShippingCoupon():e<3e3&&(this.coupon=null)}},computed:{...P(I,["getUser"]),calculateSubtotal(){return this.cart.reduce((e,s)=>e+s.price*s.qty,0)},processedShipping(){return this.cart.length>0?this.shipping:0},calculateTotalPrice(){const e=this.calculateSubtotal,s=this.coupon?this.coupon.discount:0;return e+this.processedShipping-s},checkoutAgree(){return this.eighteenPlusAgree&&this.privacyAgree}},mounted(){const{userId:e}=this.getUserCookie();this.userId=e,this.getCartList(),this.getFavoriteList()}},r=e=>(T("data-v-2d3538f2"),e=e(),U(),e),j=r(()=>t("div",{class:"bg-checkout pb-4"},[t("h2",{class:"pb-5 text-white container"},"填寫訂單資訊")],-1)),B={class:"container pb-5"},R=r(()=>t("img",{src:N,class:"w-100 mb-5",alt:"line"},null,-1)),Y=r(()=>t("div",{class:"progress mb-5 fs-5",role:"progressbar","aria-label":"Animated striped example"},[t("div",{class:"progress-bar bg-primary",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 確認購物車 "),t("div",{class:"progress-bar bg-primary progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 填寫資料 "),t("div",{class:"progress-bar bg-secondary",role:"progressbar",style:{width:"34%"},"aria-valuenow":"34","aria-valuemin":"0","aria-valuemax":"100"}," 完成訂單 ")],-1)),W={class:"row gy-4 flex-column flex-md-row"},$={class:"col-12 col-md-8"},O=r(()=>t("h4",{class:"pb-4"},"1. 收件者資訊",-1)),G={class:"pb-5"},z={class:"form-floating mb-3"},Q=r(()=>t("label",{for:"username"},"＊ 姓名",-1)),H={class:"form-floating mb-3"},J=r(()=>t("label",{for:"customerAddress"},"＊ 寄送地址",-1)),K={class:"form-floating mb-3"},X=r(()=>t("label",{for:"customerTel"},"＊ 電話",-1)),Z={class:"form-floating mb-3"},ee=r(()=>t("label",{for:"customerEmail"},"＊ 電子郵件",-1)),te=r(()=>t("h4",{class:"pb-4"},"2. 付款資訊",-1)),se={class:"pb-5"},ae={class:"form-floating mb-3"},re=r(()=>t("label",{for:"creditCard"},"＊ 卡號",-1)),oe={class:"form-floating mb-3"},ie=r(()=>t("label",{for:"cardName"},"＊ 持卡人姓名",-1)),le={class:"form-floating mb-3"},ce=r(()=>t("label",{for:"cardExpiration"},"＊ 有效日期 (MMYY)",-1)),ne={class:"form-floating mb-3"},de=r(()=>t("label",{for:"secureCode"},"＊ 安全碼",-1)),ue={class:"col-12 col-md-4"},me={class:"totalPrice pb-5"},he={class:"card fs-5"},pe=r(()=>t("div",{class:"card-header bg-primary fs-5 p-3 ps-4 text-white"},"購物車",-1)),fe={class:"card-body"},_e={class:"d-flex justify-content-between"},ge=r(()=>t("p",{class:"card-text"},"商品小計",-1)),ve={class:"card-text"},be={class:"d-flex justify-content-between"},ye=r(()=>t("p",{class:"card-text"},"運費價格",-1)),xe={class:"card-text"},Ce={class:"d-flex justify-content-between"},De=r(()=>t("p",{class:"card-text"},"優惠卷",-1)),Ie={key:0,class:"card-text text-danger"},Se={key:1,class:"card-text"},Ve=r(()=>t("div",{class:"d-flex justify-content-center"},[t("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),we={class:"card-body d-flex flex-column justify-content-between"},ke={class:"d-flex justify-content-between fw-bold"},Fe=r(()=>t("p",{class:"card-text"},"總計",-1)),Le={class:"card-text text-danger fs-4"},Ae={class:"form-check mb-3"},Ee=r(()=>t("label",{class:"form-check-label",for:"eighteenPlusAgree"}," 我已年滿18歲 ",-1)),Pe={class:"form-check"},Te=r(()=>t("label",{class:"form-check-label",for:"privacyAgree"}," 我同意服務及隱私權條款 ",-1));function Ue(e,s,l,h,a,c){const V=_("WineGlassLoader"),w=_("Loading"),p=_("VeeField"),f=_("ErrorMessage"),k=_("VeeForm");return y(),b("div",null,[i(w,{active:a.isLoading,"onUpdate:active":s[0]||(s[0]=n=>a.isLoading=n),"is-full-page":a.fullPage},{default:x(()=>[i(V)]),_:1},8,["active","is-full-page"]),j,t("div",B,[R,Y,i(k,{ref:"checkout-form",onSubmit:c.createOrder},{default:x(({errors:n})=>[t("div",W,[t("div",$,[O,t("div",G,[t("div",z,[i(p,{id:"customerName",name:"姓名",type:"text",class:u(["form-control",{"is-invalid":n.姓名}]),placeholder:"請輸入名稱",rules:"required|min:2|max:16",modelValue:a.userData.user.customerName,"onUpdate:modelValue":s[1]||(s[1]=o=>a.userData.user.customerName=o)},null,8,["class","modelValue"]),Q,i(f,{name:"姓名",class:"invalid-feedback"})]),t("div",H,[i(p,{id:"customerAddress",name:"地址",type:"text",class:u(["form-control",{"is-invalid":n.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:a.userData.user.customerAddress,"onUpdate:modelValue":s[2]||(s[2]=o=>a.userData.user.customerAddress=o)},null,8,["class","modelValue"]),J,i(f,{name:"地址",class:"invalid-feedback"})]),t("div",K,[i(p,{id:"customerTel",name:"電話",type:"tel",class:u(["form-control",{"is-invalid":n.電話}]),placeholder:"請輸入電話",rules:c.isPhone,modelValue:a.userData.user.customerTel,"onUpdate:modelValue":s[3]||(s[3]=o=>a.userData.user.customerTel=o)},null,8,["class","rules","modelValue"]),X,i(f,{name:"電話",class:"invalid-feedback"})]),t("div",Z,[i(p,{id:"customerEmail",name:"email",type:"email",class:u(["form-control",{"is-invalid":n.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:a.userData.user.customerEmail,"onUpdate:modelValue":s[4]||(s[4]=o=>a.userData.user.customerEmail=o)},null,8,["class","modelValue"]),ee,i(f,{name:"email",class:"invalid-feedback"})])]),te,t("div",se,[t("div",ae,[i(p,{id:"creditCard",name:"信用卡號",type:"text",class:u(["form-control",{"is-invalid":n.信用卡號}]),placeholder:"請輸入信用卡號",rules:c.isCreditCard,modelValue:a.userData.payment.creditCard,"onUpdate:modelValue":s[5]||(s[5]=o=>a.userData.payment.creditCard=o)},null,8,["class","rules","modelValue"]),re,i(f,{name:"信用卡號",class:"invalid-feedback"})]),t("div",oe,[i(p,{id:"cardName",name:"持卡人姓名",type:"text",class:u(["form-control",{"is-invalid":n.持卡人姓名}]),placeholder:"請輸入持卡人姓名",rules:"required|min:2|max:16",modelValue:a.userData.payment.cardName,"onUpdate:modelValue":s[6]||(s[6]=o=>a.userData.payment.cardName=o)},null,8,["class","modelValue"]),ie,i(f,{name:"持卡人姓名",class:"invalid-feedback"})]),t("div",le,[i(p,{id:"cardExpiration",name:"有效日期",type:"text",class:u(["form-control",{"is-invalid":n.有效日期}]),placeholder:"請輸入有效日期 (MM/YY)",rules:c.isDateFormat,modelValue:a.userData.payment.cardExpiration,"onUpdate:modelValue":s[7]||(s[7]=o=>a.userData.payment.cardExpiration=o)},null,8,["class","rules","modelValue"]),ce,i(f,{name:"有效日期",class:"invalid-feedback"})]),t("div",ne,[i(p,{id:"secureCode",name:"安全碼",type:"number",class:u(["form-control",{"is-invalid":n.安全碼}]),placeholder:"請輸入三位數的安全碼",rules:c.isSecurityCode,modelValue:a.userData.payment.secureCode,"onUpdate:modelValue":s[8]||(s[8]=o=>a.userData.payment.secureCode=o)},null,8,["class","rules","modelValue"]),de,i(f,{name:"安全碼",class:"invalid-feedback"})])])]),t("div",ue,[t("div",me,[t("div",he,[pe,t("div",fe,[t("div",_e,[ge,t("p",ve,"NT$ "+v(c.calculateSubtotal),1)]),t("div",be,[ye,t("p",xe,"NT$ "+v(c.processedShipping),1)]),t("div",Ce,[De,a.coupon?(y(),b("p",Ie,"- NT$ "+v(a.coupon.discount),1)):(y(),b("p",Se,"沒有可用的優惠卷"))])]),Ve,t("div",we,[t("div",ke,[Fe,t("p",Le,"NT$ "+v(c.calculateTotalPrice)+" 元",1)]),t("div",Ae,[C(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[9]||(s[9]=o=>a.eighteenPlusAgree=o),id:"eighteenPlusAgree"},null,512),[[D,a.eighteenPlusAgree]]),Ee]),t("div",Pe,[C(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[10]||(s[10]=o=>a.privacyAgree=o),id:"privacyAgree"},null,512),[[D,a.privacyAgree]]),Te])]),t("button",{href:"#",type:"submit",class:u(["btn bg-primary-low fs-5 text-white py-3",{notAllow:!c.checkoutAgree}])}," 確認完成並付款 ",2)])])])])]),_:1},8,["onSubmit"])])])}const We=F(q,[["render",Ue],["__scopeId","data-v-2d3538f2"]]);export{We as default};
