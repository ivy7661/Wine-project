import{S as m}from"./sweetalert2.all-z-9cJw1m.js";import{_ as T,L as j,m as q,I as B,g as u,h as U,c as a,b as v,w as C,a as t,F as b,j as y,i as g,t as h,y as w,k as _,r as x,o as n,B as D,z as V,A as N,d as E,p as $,e as A}from"./index-6PzzfaJ8.js";import{u as k}from"./user-qX7th_-E.js";/* empty css              */import{W as I}from"./WineGlassLoader-yM45y1Ob.js";import{_ as Q}from"./footerContainer-TBENB7Dp.js";import{_ as R}from"./wine hand style-CA-_iX33.js";import"./helpers-Hx-ZzB2u.js";var W={VITE_API_URL:"https://wine-project-tmiy.onrender.com",VITE_REPO_NAME:"Wine-project",BASE_URL:"/Wine-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:p}=W,M={name:"CartView",data(){return{title:"購物車",quantityOptions:[1,2,3,4,5,6,7,8,9,10],cartAll:[],cart:[],favoriteList:[],allFavoriteList:[],coupon:null,shipping:300,newQty:1,userId:"",isLoading:!1,fullPage:!0}},components:{Loading:j,WineGlassLoader:I},methods:{...q(k,["setUser","cleanUser","getUserCookie","resetUserCarts"]),doLoading(){this.$loading.show({props:{spinner:I},container:this.$refs.loadingContainer,canCancel:!0,color:"#000000",loader:"spinner",width:64,height:64,backgroundColor:"#ffffff",opacity:.5,zIndex:999},{default:B("WineGlassLoader")}).hide()},setLoadingTime(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},800)},getCartList(){const e=`${p}/carts`;u.get(e).then(s=>{this.setLoadingTime(),this.cartAll=s.data,this.cart=s.data.filter(l=>l.userId===this.userId)}).catch(()=>{})},updateCartQty(e){const s=`${p}/carts`,l={qty:e.qty};e.qty===0?this.deleteCartItem(e):u.patch(`${s}/${e.id}`,l).then(f=>{this.resetUserCarts()}).catch(()=>{})},increaseQty(e){e.qty++,this.updateCartQty(e)},decreaseQty(e){e.qty>1&&(e.qty--,this.updateCartQty(e))},deleteCartItem(e){m.fire({title:"確認刪除？",text:"刪除後將無法恢復！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(s=>{if(s.isConfirmed){const l=`${p}/carts`;u.delete(`${l}/${e.id}`,{userId:this.userId,id:e.id}).then(f=>{this.resetUserCarts(),this.getCartList(),m.fire({title:"移出購物車",text:"商品已經成功移出購物車",icon:"success"})}).catch(()=>{})}else e.qty=1})},seeProduct(e){this.$router.push({name:"ProductDetail",params:{id:e}})},getFavoriteList(){const e=`${p}/favorite`;u.get(e).then(s=>{this.allFavoriteList=s.data,this.favoriteList=s.data.filter(l=>l.userId===this.userId),this.checkFavoriteStatus()}).catch(()=>{})},checkFavoriteStatus(){this.cart.forEach(e=>{e.isFavorite=this.isProductInFavorite(e.id)})},isProductInFavorite(e){return this.favoriteList.some(s=>s.productId===e)},addToFavorite(e){if(!this.userId){m.fire({title:"請先登入",html:"前往登入頁面",icon:"question",showCancelButton:!0,cancelButtonText:"取消"}).then(c=>{c.isConfirmed&&this.goLogin()});return}const s=`${p}/favorite`,l=new Date,f=`${l.getFullYear()}/${(l.getMonth()+1).toString().padStart(2,"0")}/${l.getDate().toString().padStart(2,"0")}`,i={userId:this.userId,productId:e,created_at:f};u.post(s,i).then(c=>{this.getFavoriteList(),m.fire({title:"加入最愛",text:"商品已經成功加入最愛清單。",icon:"success"})}).catch(()=>{})},toggleFavorite(e){this.isProductInFavorite(e.id)?this.removeFromFavorite(e.id):this.addToFavorite(e.id)},removeFromFavorite(e){if(!this.userId){m.fire({title:"請先登入",html:"前往登入頁面",icon:"question",showCancelButton:!0,cancelButtonText:"取消"}).then(i=>{i.isConfirmed&&this.goLogin()});return}const s=`${p}/favorite`,l=this.allFavoriteList.findIndex(i=>i.productId===e&&i.userId===this.userId),f=this.allFavoriteList[l].id;u.delete(`${s}/${f}`,{userId:this.userId,id:l}).then(i=>{this.getFavoriteList()}).catch(()=>{})},applyFreeShippingCoupon(){const e=`${p}/coupons`;u.get(e).then(s=>{this.coupon=s.data[0]}).catch(()=>{})},toCheckoutPage(){this.cart.length>0?this.$router.push({name:"CheckoutPage"}):this.cart.length===0&&alert("目前購物車沒有商品唷！！")}},watch:{calculateSubtotal(e){e>=3e3?this.applyFreeShippingCoupon():e<3e3&&(this.coupon=null)}},computed:{...U(k,["getUser"]),calculateSubtotal(){return this.cart.reduce((e,s)=>e+s.price*s.qty,0)},processedShipping(){return this.cart.length>0?this.shipping:0},calculateTotalPrice(){const e=this.calculateSubtotal,s=this.coupon?this.coupon.discount:0;return e+this.processedShipping-s}},mounted(){const{userId:e}=this.getUserCookie();this.userId=e,this.getCartList(),this.getFavoriteList()}},r=e=>($("data-v-34013af6"),e=e(),A(),e),O=r(()=>t("div",{class:"bg-cart pb-4"},[t("h2",{class:"pb-5 text-white container"},"購物車資訊")],-1)),z={class:"container pb-5"},G=r(()=>t("img",{src:Q,class:"w-100 mb-5",alt:"line"},null,-1)),Y=r(()=>t("div",{class:"progress mb-5 fs-5",role:"progressbar","aria-label":"Animated striped example"},[t("div",{class:"progress-bar bg-primary progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 確認購物車 "),t("div",{class:"progress-bar bg-secondary",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 填寫資料 "),t("div",{class:"progress-bar bg-secondary",role:"progressbar",style:{width:"34%"},"aria-valuenow":"34","aria-valuemin":"0","aria-valuemax":"100"}," 完成訂單 ")],-1)),H={class:"row gy-4 flex-md-row"},J={class:"col-12 col-md-8"},K={class:"cartList d-flex flex-column border border-primary rounded"},X=r(()=>t("div",{class:"bg-primary fs-5 text-white mb-3 p-3 ps-4"},"訂購清單",-1)),Z={key:0,class:"p-3"},tt=["onClick"],et=["onClick"],st={href:"#",class:"wine_image_block"},it={class:"card-body d-flex flex-column justify-content-around"},ot={class:"d-flex mb-1 justify-content-between"},at={key:0,class:"badge bg-danger mb-2"},nt={class:"d-flex gap-1"},rt={href:"#"},ct={class:"card-title text-black fs-4"},lt=r(()=>t("p",null,"750 ml",-1)),dt={class:"text-primary"},ht={class:"d-flex justify-content-between"},ut={key:0,class:"d-flex align-items-center"},_t=["onClick"],pt=r(()=>t("i",{class:"bi bi-dash fs-4"},null,-1)),ft=[pt],gt=["onClick"],mt=r(()=>t("i",{class:"bi bi-plus fs-4"},null,-1)),vt=[mt],bt={key:1,class:"row"},yt={class:"col"},xt=["onUpdate:modelValue","onChange"],Ct=["value"],wt=["onClick"],kt=r(()=>t("i",{class:"bi bi-trash"},null,-1)),It=[kt],Lt={key:1,class:"p-3"},Ft={class:"row"},St=r(()=>t("div",{class:"col-12 col-md-4"},[t("img",{src:R,alt:"shopping-cart",class:"img-fluid"})],-1)),Pt={class:"col-12 col-md-8 d-flex flex-column justify-content-center"},Tt=r(()=>t("p",{class:"fs-5"},"看來你購物車目前還空空喔 ~~~",-1)),jt={key:2,class:"d-flex justify-content-center mt-3 mb-5"},qt=r(()=>t("div",{class:"bg-black text-center line",style:{height:"1px"}},null,-1)),Bt=[qt],Ut={key:3,class:"d-flex flex-column align-items-end pe-3"},Dt={key:0,class:"text-primary fs-5"},Vt={key:1,class:"text-primary fs-5"},Nt={class:"text-end mb-1"},Et={class:"fs-4"},$t={key:0,class:"col-12 col-md-4"},At={class:"totalPrice"},Qt={class:"card fs-5"},Rt=r(()=>t("div",{class:"card-header bg-primary fs-5 p-3 ps-4 text-white"},"購物車",-1)),Wt={class:"card-body"},Mt={class:"d-flex justify-content-between"},Ot=r(()=>t("p",{class:"card-text"},"商品小計",-1)),zt={class:"card-text"},Gt={class:"d-flex justify-content-between"},Yt=r(()=>t("p",{class:"card-text"},"運費價格",-1)),Ht={class:"card-text"},Jt={class:"d-flex justify-content-between"},Kt=r(()=>t("p",{class:"card-text"},"優惠卷",-1)),Xt={key:0,class:"card-text text-danger"},Zt={key:1,class:"card-text"},te=r(()=>t("div",{class:"d-flex justify-content-center"},[t("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),ee={class:"card-body d-flex justify-content-between fw-bold"},se=r(()=>t("p",{class:"card-text"},"總計",-1)),ie={class:"card-text text-danger fs-4"};function oe(e,s,l,f,i,c){const L=x("WineGlassLoader"),F=x("Loading"),S=x("RouterLink");return n(),a("div",null,[v(F,{active:i.isLoading,"onUpdate:active":s[0]||(s[0]=o=>i.isLoading=o),"is-full-page":i.fullPage},{default:C(()=>[v(L)]),_:1},8,["active","is-full-page"]),O,t("div",z,[G,Y,t("div",H,[t("div",J,[t("div",K,[X,i.cart.length>0?(n(),a("div",Z,[(n(!0),a(b,null,y(i.cart,(o,P)=>(n(),a("a",{href:"#",key:P,class:"card shadow d-flex flex-row justify-content-between mb-3 fs-4 pe-3 py-1 radius-24",onClick:_(d=>c.seeProduct(o.product_id),["prevent"])},[t("a",{href:"#",onClick:_(d=>c.toggleFavorite(o),["prevent","stop"])},[t("i",{class:w(["bi heart position-absolute top-5 start-5",{"bi-heart":!o.isFavorite,"bi-heart-fill":o.isFavorite}])},null,2)],8,et),t("a",st,[t("div",{class:"wine_image",style:D({"background-image":`url(${e.$filters.imgPath("/images/wine_images/"+o.image+".jpg")})`})},null,4)]),t("div",it,[t("div",ot,[o.is_hot?(n(),a("span",at,"熱門推薦")):g("",!0),t("div",nt,[(n(!0),a(b,null,y(o.star,d=>(n(),a("i",{class:"bi bi-star-fill text-warning",key:d}))),128))])]),t("a",rt,[t("h5",ct,h(o.chineseName),1)]),lt,t("p",dt,"$ "+h(o.price),1),t("div",ht,[t("div",{class:"input-group mb-3",onClick:s[1]||(s[1]=_(()=>{},["prevent","stop"]))},[o.qty>10?(n(),a("div",ut,[t("button",{class:"btn btn-outline-secondary btn-sm me-1",onClick:_(d=>c.decreaseQty(o),["prevent"])},ft,8,_t),t("div",null,h(o.qty),1),t("button",{class:"btn btn-outline-secondary btn-sm ms-1",onClick:_(d=>c.increaseQty(o),["prevent"])},vt,8,gt)])):(n(),a("div",bt,[t("div",yt,[V(t("select",{class:"form-select fs-4","onUpdate:modelValue":d=>o.qty=d,onChange:d=>c.updateCartQty(o)},[(n(!0),a(b,null,y(i.quantityOptions,d=>(n(),a("option",{key:d,value:d},h(d),9,Ct))),128))],40,xt),[[N,o.qty]])])]))]),t("a",{href:"#",onClick:_(d=>c.deleteCartItem(o),["prevent","stop"])},It,8,wt)])])],8,tt))),128))])):(n(),a("div",Lt,[t("div",Ft,[St,t("div",Pt,[t("div",null,[Tt,v(S,{to:"/products",class:"fs-5"},{default:C(()=>[E("立刻前往商品區逛逛！!")]),_:1})])])])])),i.cart.length>0?(n(),a("div",jt,Bt)):g("",!0),i.cart.length>0?(n(),a("div",Ut,[i.coupon?(n(),a("p",Dt,"太棒了！訂單滿3000元，獲得免運！")):g("",!0),i.coupon?g("",!0):(n(),a("p",Vt," 再 "+h(3e3-c.calculateSubtotal)+" 元即可獲得免運唷！ ",1)),t("div",null,[t("p",Nt,"(共 "+h(i.cart.length)+" 件商品)",1),t("p",Et,"小計: NT$ "+h(c.calculateSubtotal)+" 元",1)])])):g("",!0)])]),i.cart.length>0?(n(),a("div",$t,[t("div",At,[t("div",Qt,[Rt,t("div",Wt,[t("div",Mt,[Ot,t("p",zt,"NT$ "+h(c.calculateSubtotal),1)]),t("div",Gt,[Yt,t("p",Ht,"NT$ "+h(c.processedShipping),1)]),t("div",Jt,[Kt,i.coupon?(n(),a("p",Xt,"- NT$ "+h(i.coupon.discount),1)):(n(),a("p",Zt,"沒有可用的優惠卷"))])]),te,t("div",ee,[se,t("p",ie,"NT$ "+h(c.calculateTotalPrice)+" 元",1)]),t("a",{href:"#",class:w(["btn bg-primary-low text-white fs-5 py-3",{disabled:!i.cart.length}]),onClick:s[2]||(s[2]=_((...o)=>c.toCheckoutPage&&c.toCheckoutPage(...o),["prevent"]))},"前往結帳頁面",2)])])])):g("",!0)])])])}const _e=T(M,[["render",oe],["__scopeId","data-v-34013af6"]]);export{_e as default};
