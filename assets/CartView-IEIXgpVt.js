import{S as f}from"./sweetalert2.all-edPz5k6j.js";import{_ as T,L as j,m as B,I as U,g as u,h as D,c as a,b as v,w,a as t,F as b,j as x,i as g,t as h,y as C,k as m,r as y,o as r,B as V,z as N,A as $,d as E,p as q,e as A}from"./index-KDcbRjT1.js";import{u as I}from"./user-GOzDLLMT.js";/* empty css              */import{W as k}from"./WineGlassLoader-vEzn1kGo.js";import{_ as R}from"./footerContainer-TBENB7Dp.js";import{_ as W}from"./wine hand style-CA-_iX33.js";import"./helpers-Hx-ZzB2u.js";var M={VITE_API_URL:"https://wine-project-tmiy.onrender.com",VITE_REPO_NAME:"Wine-project",BASE_URL:"/Wine-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:_}=M,O={name:"CartView",data(){return{title:"購物車",quantityOptions:[1,2,3,4,5,6,7,8,9,10],cartAll:[],cart:[],favoriteList:[],allFavoriteList:[],coupon:null,shipping:300,newQty:1,userId:"",isLoading:!1,fullPage:!0}},components:{Loading:j,WineGlassLoader:k},methods:{...B(I,["setUser","cleanUser","getUserCookie","resetUserCarts"]),doLoading(){this.$loading.show({props:{spinner:k},container:this.$refs.loadingContainer,canCancel:!0,color:"#000000",loader:"spinner",width:64,height:64,backgroundColor:"#ffffff",opacity:.5,zIndex:999},{default:U("WineGlassLoader")}).hide()},setLoadingTime(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},800)},getCartList(){const e=`${_}/carts`;u.get(e).then(s=>{this.setLoadingTime(),this.cartAll=s.data,this.cart=s.data.filter(c=>c.userId===this.userId)}).catch(()=>{})},updateCartQty(e){const s=`${_}/carts`,c={qty:e.qty};e.qty===0?this.deleteCartItem(e):u.patch(`${s}/${e.id}`,c).then(p=>{this.resetUserCarts()}).catch(()=>{})},deleteCartItem(e){f.fire({title:"確認刪除？",text:"刪除後將無法恢復！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(s=>{if(s.isConfirmed){const c=`${_}/carts`;u.delete(`${c}/${e.id}`,{userId:this.userId,id:e.id}).then(p=>{this.resetUserCarts(),this.getCartList(),f.fire({title:"移出購物車",text:"商品已經成功移出購物車",icon:"success"})}).catch(()=>{})}else e.qty=1})},seeProduct(e){this.$router.push({name:"ProductDetail",params:{id:e}})},getFavoriteList(){const e=`${_}/favorite`;u.get(e).then(s=>{this.allFavoriteList=s.data,this.favoriteList=s.data.filter(c=>c.userId===this.userId),this.checkFavoriteStatus()}).catch(()=>{})},checkFavoriteStatus(){this.cart.forEach(e=>{e.isFavorite=this.isProductInFavorite(e.id)})},isProductInFavorite(e){return this.favoriteList.some(s=>s.productId===e)},addToFavorite(e){if(!this.userId){f.fire({title:"請先登入",html:"前往登入頁面",icon:"question",showCancelButton:!0,cancelButtonText:"取消"}).then(()=>{this.goLogin()});return}const s=`${_}/favorite`,c=new Date,p=`${c.getFullYear()}/${(c.getMonth()+1).toString().padStart(2,"0")}/${c.getDate().toString().padStart(2,"0")}`,i={userId:this.userId,productId:e,created_at:p};u.post(s,i).then(l=>{this.getFavoriteList(),f.fire({title:"加入最愛",text:"商品已經成功加入最愛清單。",icon:"success"})}).catch(()=>{})},toggleFavorite(e){this.isProductInFavorite(e.id)?this.removeFromFavorite(e.id):this.addToFavorite(e.id)},removeFromFavorite(e){if(!this.userId){f.fire({title:"請先登入",html:"前往登入頁面",icon:"question",showCancelButton:!0,cancelButtonText:"取消"}).then(()=>{this.goLogin()});return}const s=`${_}/favorite`,c=this.allFavoriteList.findIndex(i=>i.productId===e&&i.userId===this.userId),p=this.allFavoriteList[c].id;u.delete(`${s}/${p}`,{userId:this.userId,id:c}).then(i=>{this.getFavoriteList()}).catch(()=>{})},applyFreeShippingCoupon(){const e=`${_}/coupons`;u.get(e).then(s=>{this.coupon=s.data[0]}).catch(()=>{})},toCheckoutPage(){this.cart.length>0?this.$router.push({name:"CheckoutPage"}):this.cart.length===0&&alert("目前購物車沒有商品唷！！")}},watch:{calculateSubtotal(e){e>=3e3?this.applyFreeShippingCoupon():e<3e3&&(this.coupon=null)}},computed:{...D(I,["getUser"]),calculateSubtotal(){return this.cart.reduce((e,s)=>e+s.price*s.qty,0)},processedShipping(){return this.cart.length>0?this.shipping:0},calculateTotalPrice(){const e=this.calculateSubtotal,s=this.coupon?this.coupon.discount:0;return e+this.processedShipping-s}},mounted(){const{userId:e}=this.getUserCookie();this.userId=e,this.getCartList(),this.getFavoriteList()}},n=e=>(q("data-v-efa12462"),e=e(),A(),e),z=n(()=>t("div",{class:"bg-cart pb-4"},[t("h2",{class:"pb-5 text-white container"},"購物車資訊")],-1)),G={class:"container pb-5"},Q=n(()=>t("img",{src:R,class:"w-100 mb-5"},null,-1)),Y=n(()=>t("div",{class:"progress mb-5 fs-5",role:"progressbar","aria-label":"Animated striped example"},[t("div",{class:"progress-bar bg-primary progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 確認購物車 "),t("div",{class:"progress-bar bg-secondary",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 填寫資料 "),t("div",{class:"progress-bar bg-secondary",role:"progressbar",style:{width:"34%"},"aria-valuenow":"34","aria-valuemin":"0","aria-valuemax":"100"}," 完成訂單 ")],-1)),H={class:"row gy-4 flex-column-reverse flex-md-row"},J={class:"col-12 col-md-8"},K={class:"cartList d-flex flex-column border border-primary rounded"},X=n(()=>t("div",{class:"bg-primary fs-5 text-white mb-3 p-3 ps-4"},"訂購清單",-1)),Z={key:0,class:"p-3"},tt=["onClick"],et=["onClick"],st={href:"#",class:"wine_image_block"},it={class:"card-body d-flex flex-column justify-content-around"},ot={class:"d-flex mb-1 justify-content-between"},at={key:0,class:"badge bg-danger mb-2"},rt={class:"d-flex gap-1"},nt={href:"#"},ct={class:"card-title text-black fs-4"},lt=n(()=>t("p",null,"750 ml",-1)),dt=n(()=>t("span",{class:"input-group-text"},"數量",-1)),ht=["onUpdate:modelValue","onChange"],ut=["value"],_t={class:"d-flex justify-content-between"},pt={class:"text-primary"},ft=["onClick"],gt=n(()=>t("i",{class:"bi bi-trash"},null,-1)),mt=[gt],vt={key:1,class:"p-3"},bt={class:"row"},xt=n(()=>t("div",{class:"col-12 col-md-4"},[t("img",{src:W,alt:"shopping-cart",class:"img-fluid"})],-1)),yt={class:"col-12 col-md-8 d-flex flex-column justify-content-center"},wt=n(()=>t("p",{class:"fs-5"},"看來你購物車目前還空空喔 ~~~",-1)),Ct={key:2,class:"d-flex justify-content-center mt-3 mb-5"},It=n(()=>t("div",{class:"bg-black text-center line",style:{height:"1px"}},null,-1)),kt=[It],Lt={key:3,class:"d-flex flex-column align-items-end pe-3"},Ft={key:0,class:"text-primary fs-5"},St={key:1,class:"text-primary fs-5"},Pt={class:"text-end mb-1"},Tt={class:"fs-4"},jt={class:"col-12 col-md-4"},Bt={class:"totalPrice"},Ut={class:"card fs-5"},Dt=n(()=>t("div",{class:"card-header bg-primary fs-5 p-3 ps-4 text-white"},"購物車",-1)),Vt={class:"card-body"},Nt={class:"d-flex justify-content-between"},$t=n(()=>t("p",{class:"card-text"},"商品小計",-1)),Et={class:"card-text"},qt={class:"d-flex justify-content-between"},At=n(()=>t("p",{class:"card-text"},"運費價格",-1)),Rt={class:"card-text"},Wt={class:"d-flex justify-content-between"},Mt=n(()=>t("p",{class:"card-text"},"優惠卷",-1)),Ot={key:0,class:"card-text text-danger"},zt={key:1,class:"card-text"},Gt=n(()=>t("div",{class:"d-flex justify-content-center"},[t("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),Qt={class:"card-body d-flex justify-content-between fw-bold"},Yt=n(()=>t("p",{class:"card-text"},"總計",-1)),Ht={class:"card-text text-danger fs-4"};function Jt(e,s,c,p,i,l){const L=y("WineGlassLoader"),F=y("loading"),S=y("RouterLink");return r(),a("div",null,[v(F,{active:i.isLoading,"onUpdate:active":s[0]||(s[0]=o=>i.isLoading=o),"is-full-page":i.fullPage},{default:w(()=>[v(L)]),_:1},8,["active","is-full-page"]),z,t("div",G,[Q,Y,t("div",H,[t("div",J,[t("div",K,[X,i.cart.length>0?(r(),a("div",Z,[(r(!0),a(b,null,x(i.cart,(o,P)=>(r(),a("a",{href:"#",key:P,class:"card shadow d-flex flex-row justify-content-between mb-3 fs-4 pe-3 py-1 radius-24",onClick:m(d=>l.seeProduct(o.product_id),["prevent"])},[t("a",{href:"#",onClick:m(d=>l.toggleFavorite(o),["prevent","stop"])},[t("i",{class:C(["bi heart position-absolute top-5 start-5",{"bi-heart":!o.isFavorite,"bi-heart-fill":o.isFavorite}])},null,2)],8,et),t("a",st,[t("div",{class:"wine_image",style:V({"background-image":`url(${e.$filters.imgPath("/images/wine_images/"+o.image+".jpg")})`})},null,4)]),t("div",it,[t("div",ot,[o.is_hot?(r(),a("span",at,"熱門推薦")):g("",!0),t("div",rt,[(r(!0),a(b,null,x(o.star,d=>(r(),a("i",{class:"bi bi-star-fill text-warning",key:d}))),128))])]),t("a",nt,[t("h5",ct,h(o.chineseName),1)]),lt,t("div",{class:"input-group mb-3",onClick:s[1]||(s[1]=m(()=>{},["prevent","stop"]))},[dt,N(t("select",{class:"form-select","onUpdate:modelValue":d=>o.qty=d,onChange:d=>l.updateCartQty(o)},[(r(!0),a(b,null,x(i.quantityOptions,d=>(r(),a("option",{key:d,value:d},h(d),9,ut))),128))],40,ht),[[$,o.qty]])]),t("div",_t,[t("p",pt,"$ "+h(o.price),1),t("a",{href:"#",onClick:m(d=>l.deleteCartItem(o),["prevent","stop"])},mt,8,ft)])])],8,tt))),128))])):(r(),a("div",vt,[t("div",bt,[xt,t("div",yt,[t("div",null,[wt,v(S,{to:"/products",class:"fs-5"},{default:w(()=>[E("立刻前往商品區逛逛！!")]),_:1})])])])])),i.cart.length>0?(r(),a("div",Ct,kt)):g("",!0),i.cart.length>0?(r(),a("div",Lt,[i.coupon?(r(),a("p",Ft,"太棒了！訂單滿3000元，獲得免運！")):g("",!0),i.coupon?g("",!0):(r(),a("p",St," 再 "+h(3e3-l.calculateSubtotal)+" 元即可獲得免運唷！ ",1)),t("div",null,[t("p",Pt,"(共 "+h(i.cart.length)+" 件商品)",1),t("p",Tt,"小計: NT$ "+h(l.calculateSubtotal)+" 元",1)])])):g("",!0)])]),t("div",jt,[t("div",Bt,[t("div",Ut,[Dt,t("div",Vt,[t("div",Nt,[$t,t("p",Et,"NT$ "+h(l.calculateSubtotal),1)]),t("div",qt,[At,t("p",Rt,"NT$ "+h(l.processedShipping),1)]),t("div",Wt,[Mt,i.coupon?(r(),a("p",Ot,"- NT$ "+h(i.coupon.discount),1)):(r(),a("p",zt,"沒有可用的優惠卷"))])]),Gt,t("div",Qt,[Yt,t("p",Ht,"NT$ "+h(l.calculateTotalPrice)+" 元",1)]),t("a",{href:"#",class:C(["btn bg-primary-low text-white fs-5 py-3",{disabled:!i.cart.length}]),onClick:s[2]||(s[2]=m((...o)=>l.toCheckoutPage&&l.toCheckoutPage(...o),["prevent"]))},"前往結帳頁面",2)])])])])])])}const ae=T(O,[["render",Jt],["__scopeId","data-v-efa12462"]]);export{ae as default};
