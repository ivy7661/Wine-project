import{S as u}from"./sweetalert2.all-KC4FWgCs.js";import{_ as C,m as F,g as l,h as S,c,a as s,F as f,i as g,y as b,L as k,z as L,j as _,e as I,x as m,o as d,t as p,k as x,p as R,d as O,f as V}from"./index-NdDJ3vZo.js";import{u as w}from"./user-bg32h6Qo.js";import{_ as D}from"./footerContainer-TBENB7Dp.js";import"./helpers-Hx-ZzB2u.js";var U={VITE_API_URL:"https://wine-project-tmiy.onrender.com",VITE_API_NAME:"",BASE_URL:"/Wine-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:h}=U,$={name:"UserProductsView",data(){return{products:[],selectedRegion:"熱賣酒品",productsContent:"",currentSort:"",selectedRegionProducts:[],cart:[],ascendingOrderPrice:!0,ascendingOrderStar:!0,searchKeyword:"",favoriteList:[],allFavoriteList:[],userId:""}},methods:{...F(w,["setUser","cleanUser","getUserCookie"]),getProductList(){const t=`${h}/products`;l.get(t).then(e=>{this.products=e.data,this.selectedRegionProducts=this.products.filter(r=>r.is_hot===1)}).catch(()=>{alert("未正確取得產品資訊，請稍後再試～")})},getCartList(){const t=`${h}/carts`;l.get(t).then(e=>{this.cart=e.data.filter(r=>r.userId===this.userId)}).catch(()=>{})},updateContent(t){const e=`${h}/productsContent`;l.get(e).then(r=>{this.productsContent=r.data}).catch(()=>{})},sortBy(t){t==="price"?this.ascendingOrderPrice=!this.ascendingOrderPrice:t==="star"&&(this.ascendingOrderStar=!this.ascendingOrderStar),this.currentSort=t},addToCart(t){if(!this.userId){alert("請先登入");return}const e=`${h}/carts`,r=this.cart.findIndex(a=>a.product_id===t.id&&a.userId===this.userId);if(r===-1){const a={product_id:t.id,chineseName:t.chineseName,image:t.image,price:t.price,is_hot:t.is_hot,star:t.star,qty:1,userId:this.userId};l.post(e,a).then(o=>{u.fire({title:"成功加入購物車",text:"商品已經成功加入購物車",icon:"success"})}).catch(()=>{u.fire({title:"加入購物車失敗",text:"請稍後再試",icon:"error"})})}else{const a=this.cart[r].id;this.cart[r].qty+=1;const o={qty:this.cart[r].qty};l.patch(`${e}/${a}`,o).then(n=>{u.fire({title:"成功加入購物車",text:"商品已經成功加入購物車",icon:"success"})}).catch(()=>{u.fire({title:"加入購物車失敗",text:"請稍後再試",icon:"error"})})}this.getCartList()},seeProduct(t){this.$router.push({name:"ProductDetail",params:{id:t}})},getFavoriteList(){const t=`${h}/favorite`;l.get(t).then(e=>{this.allFavoriteList=e.data,this.favoriteList=e.data.filter(r=>r.userId===this.userId),this.checkFavoriteStatus()}).catch(e=>{console.log(e)})},checkFavoriteStatus(){this.sortedProducts.forEach(t=>{t.isFavorite=this.isProductInFavorite(t.id)})},isProductInFavorite(t){return this.favoriteList.some(e=>e.productId===t)},addToFavorite(t){if(!this.userId){alert("請先登入");return}const e=`${h}/favorite`,r=new Date,a=`${r.getFullYear()}/${(r.getMonth()+1).toString().padStart(2,"0")}/${r.getDate().toString().padStart(2,"0")}`,o={userId:this.userId,productId:t,created_at:a};l.post(e,o).then(n=>{this.getFavoriteList(),u.fire({title:"加入最愛",text:"商品已經成功加入最愛清單。",icon:"success"})}).catch(()=>{})},toggleFavorite(t){this.isProductInFavorite(t.id)?this.removeFromFavorite(t.id):this.addToFavorite(t.id)},removeFromFavorite(t){if(!this.userId){alert("請先登入");return}const e=`${h}/favorite`,r=this.allFavoriteList.findIndex(o=>o.productId===t&&o.userId===this.userId),a=this.allFavoriteList[r].id;l.delete(`${e}/${a}`,{userId:this.userId,id:r}).then(o=>{this.getFavoriteList(),u.fire({title:"移出最愛",text:"商品已經成功移出最愛清單",icon:"success"})}).catch(()=>{})}},computed:{...S(w,["getUser"]),sortedProducts(){return this.selectedRegionProducts.slice().sort((t,e)=>this.currentSort==="price"?this.ascendingOrderPrice?t.price-e.price:e.price-t.price:this.currentSort==="star"?this.ascendingOrderStar?t.star-e.star:e.star-t.star:0)}},watch:{selectedRegion(t){this.updateContent(t),t==="熱賣酒品"?this.selectedRegionProducts=this.products.filter(e=>e.is_hot===1):this.selectedRegionProducts=this.products.filter(e=>e.place===t)}},mounted(){const{userId:t}=this.getUserCookie();this.userId=t,this.getProductList(),this.getCartList(),this.updateContent(),this.getFavoriteList()}},y=t=>(R("data-v-1a77bc6f"),t=t(),O(),t),j={class:"bg-products pb-4"},B={class:"container"},E={class:"row justify-content-between"},N={class:"col-md-6"},A={key:0},M={class:"pb-5 text-white"},T={class:"text-white lh-large"},q={class:"col-md-3 d-flex flex-column justify-content-between"},z={class:"searchArea"},K=y(()=>s("i",{class:"bi bi-search"},null,-1)),Q={class:"filterBox"},W=V('<option value="" disabled selected hidden data-v-1a77bc6f>產區: 請選擇產區</option><option value="波爾多" data-v-1a77bc6f>波爾多</option><option value="布根地" data-v-1a77bc6f>布根地</option><option value="香檳" data-v-1a77bc6f>香檳</option><option value="羅亞爾河谷" data-v-1a77bc6f>羅亞爾河谷</option><option value="薄酒萊" data-v-1a77bc6f>薄酒萊</option><option value="熱賣酒品" data-v-1a77bc6f>熱賣酒品</option>',7),Y=[W],G={class:"filterBtn d-flex justify-content-between gap-3"},H={class:"container"},J=y(()=>s("img",{src:D,class:"w-100 mb-5"},null,-1)),X={class:"productList pb-5 align-items-stretch"},Z={class:"row mb-3 gy-3"},tt={class:"card h-100 p-2"},et={class:"row h-100"},st={class:"col-4"},it=["onClick"],rt=["onClick"],ot=["src","alt"],at={class:"col-8"},nt={class:"card-body d-flex flex-column h-100 justify-content-between"},ct={class:"mb-2"},dt={class:"d-flex mb-1 justify-content-between"},lt={key:0,class:"badge bg-danger mb-2"},ht={class:"d-flex gap-1"},ut=["onClick"],_t={class:"card-title flex-fill"},vt={class:"card-text text-danger fw-bold"},pt=["onClick"];function ft(t,e,r,a,o,n){return d(),c("div",null,[s("div",j,[s("div",B,[s("div",E,[s("div",N,[(d(!0),c(f,null,g(o.productsContent,i=>(d(),c("div",{key:i.title},[o.selectedRegion===i.title?(d(),c("div",A,[s("h2",M,"法國五大產區 - "+p(i.title),1),s("p",T,p(i.content),1)])):x("",!0)]))),128))]),s("div",q,[s("div",z,[K,b(s("input",{type:"text",placeholder:"請輸入關鍵字",class:"w-100","onUpdate:modelValue":e[0]||(e[0]=i=>o.searchKeyword=i)},null,512),[[k,o.searchKeyword]])]),s("div",Q,[b(s("select",{id:"wineRegion",name:"wineRegion",class:"mb-3","onUpdate:modelValue":e[1]||(e[1]=i=>o.selectedRegion=i),onChange:e[2]||(e[2]=i=>n.updateContent(o.selectedRegion))},Y,544),[[L,o.selectedRegion]]),s("div",G,[s("a",{type:"button",class:"btn btn-primary btn-lg px-4 py-2",onClick:e[3]||(e[3]=_(i=>n.sortBy("price"),["prevent"]))},[I(" 價格 "),s("i",{class:m(o.ascendingOrderPrice?"bi bi-arrow-down":"bi bi-arrow-up")},null,2)]),s("a",{type:"button",class:"btn btn-primary btn-lg px-4 py-2 me-0",onClick:e[4]||(e[4]=_(i=>n.sortBy("star"),["prevent"]))},[I(" 評價 "),s("i",{class:m(o.ascendingOrderStar?"bi bi-arrow-down":"bi bi-arrow-up")},null,2)])])])])])])]),s("div",H,[J,s("div",X,[s("div",Z,[(d(!0),c(f,null,g(n.sortedProducts,(i,P)=>(d(),c("div",{class:"col-12 col-md-6 col-lg-4",key:P},[s("div",tt,[s("div",et,[s("div",st,[s("a",{href:"#",onClick:_(v=>n.toggleFavorite(i),["prevent"])},[s("i",{class:m(["bi heart position-absolute top-5 start-5",{"bi-heart":!i.isFavorite,"bi-heart-fill":i.isFavorite}])},null,2)],8,it),s("a",{href:"#",onClick:_(v=>n.seeProduct(i.id),["prevent"])},[s("img",{src:`/images/wine_images/${i.image}.jpg`,class:"card-img-top h-100",alt:i.chineseName},null,8,ot)],8,rt)]),s("div",at,[s("div",nt,[s("div",ct,[s("div",dt,[i.is_hot?(d(),c("span",lt,"熱門推薦")):x("",!0),s("div",ht,[(d(!0),c(f,null,g(i.star,v=>(d(),c("i",{class:"bi bi-star-fill text-warning",key:v}))),128))])]),s("div",null,[s("a",{href:"#",class:"text-black",onClick:_(v=>n.seeProduct(i.id),["prevent"])},[s("h5",_t,p(i.chineseName),1)],8,ut),s("p",vt,"$ "+p(i.price),1)])]),s("a",{href:"#",class:"btn btn-primary w-100",onClick:_(v=>n.addToCart(i),["prevent"])},"加入購物車",8,pt)])])])])]))),128))])])])])}const wt=C($,[["render",ft],["__scopeId","data-v-1a77bc6f"]]);export{wt as default};
