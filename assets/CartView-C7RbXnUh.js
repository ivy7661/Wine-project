import{S as m}from"./sweetalert2.all-hbp0Kpox.js";import{_ as w,m as I,g as u,h as C,c as n,a as t,F as g,i as b,k as f,t as d,j as v,o as l,x as k,A as F,y as S,L,p as P,d as $}from"./index-27vkpBRK.js";import{u as x}from"./user-WPnZOVV0.js";import{_ as j}from"./footerContainer-TBENB7Dp.js";import"./helpers-Hx-ZzB2u.js";var T={VITE_API_URL:"https://wine-project-tmiy.onrender.com",VITE_REPO_NAME:"Wine-project",BASE_URL:"/Wine-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:_}=T,D={name:"CartView",data(){return{title:"購物車",cartAll:[],cart:[],favoriteList:[],allFavoriteList:[],coupon:null,shipping:300,newQty:1,userId:""}},methods:{...I(x,["setUser","cleanUser","getUserCookie"]),getCartList(){const e=`${_}/carts`;u.get(e).then(s=>{console.log(s.data,this.userId),this.cartAll=s.data,this.cart=s.data.filter(i=>i.userId===this.userId),console.log(this.cart)}).catch(()=>{})},updateCartQty(e){const s=`${_}/carts`,i={qty:e.qty};e.qty===0?this.deleteCartItem(e):u.patch(`${s}/${e.id}`,i).then(p=>{}).catch(()=>{})},deleteCartItem(e){m.fire({title:"確認刪除？",text:"刪除後將無法恢復！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(s=>{if(s.isConfirmed){const i=`${_}/carts`;u.delete(`${i}/${e.id}`,{userId:this.userId,id:e.id}).then(p=>{this.getCartList(),m.fire({title:"移出購物車",text:"商品已經成功移出購物車",icon:"success"})}).catch(()=>{})}else e.qty=1})},seeProduct(e){this.$router.push({name:"ProductDetail",params:{id:e}})},getFavoriteList(){const e=`${_}/favorite`;u.get(e).then(s=>{this.allFavoriteList=s.data,this.favoriteList=s.data.filter(i=>i.userId===this.userId),this.checkFavoriteStatus()}).catch(()=>{})},checkFavoriteStatus(){this.cart.forEach(e=>{e.isFavorite=this.isProductInFavorite(e.id)})},isProductInFavorite(e){return this.favoriteList.some(s=>s.productId===e)},addToFavorite(e){if(!this.userId){alert("請先登入");return}const s=`${_}/favorite`,i=new Date,p=`${i.getFullYear()}/${(i.getMonth()+1).toString().padStart(2,"0")}/${i.getDate().toString().padStart(2,"0")}`,r={userId:this.userId,productId:e,created_at:p};u.post(s,r).then(c=>{this.getFavoriteList(),m.fire({title:"加入最愛",text:"商品已經成功加入最愛清單。",icon:"success"})}).catch(()=>{})},toggleFavorite(e){this.isProductInFavorite(e.id)?this.removeFromFavorite(e.id):this.addToFavorite(e.id)},removeFromFavorite(e){if(!this.userId){alert("請先登入");return}const s=`${_}/favorite`,i=this.allFavoriteList.findIndex(r=>r.productId===e&&r.userId===this.userId),p=this.allFavoriteList[i].id;u.delete(`${s}/${p}`,{userId:this.userId,id:i}).then(r=>{this.getFavoriteList(),m.fire({title:"移出最愛",text:"商品已經成功移出最愛清單",icon:"success"})}).catch(()=>{})},applyFreeShippingCoupon(){const e=`${_}/coupons`;u.get(e).then(s=>{this.coupon=s.data[0]}).catch(()=>{})},toCheckoutPage(){this.cart.length>0?(console.log(this.cart.length),this.$router.push({name:"CheckoutPage"})):this.cart.length===0&&alert("目前購物車沒有商品唷！！")}},watch:{calculateSubtotal(e){e>=3e3?this.applyFreeShippingCoupon():e<3e3&&(this.coupon=null)}},computed:{...C(x,["getUser"]),calculateSubtotal(){return this.cart.reduce((e,s)=>e+s.price*s.qty,0)},processedShipping(){return this.cart.length>0?this.shipping:0},calculateTotalPrice(){const e=this.calculateSubtotal,s=this.coupon?this.coupon.discount:0;return e+this.processedShipping-s}},mounted(){const{userId:e}=this.getUserCookie();this.userId=e,this.getCartList(),this.getFavoriteList()}},o=e=>(P("data-v-111ee261"),e=e(),$(),e),E=o(()=>t("div",{class:"bg-cart pb-4"},[t("h2",{class:"pb-5 text-white container"},"購物車資訊")],-1)),U={class:"container pb-5"},V=o(()=>t("img",{src:j,class:"w-100 mb-5"},null,-1)),A=o(()=>t("div",{class:"progress mb-5 fs-5",role:"progressbar","aria-label":"Animated striped example"},[t("div",{class:"progress-bar bg-primary progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 確認購物車 "),t("div",{class:"progress-bar bg-secondary",role:"progressbar",style:{width:"33%"},"aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"}," 填寫資料 "),t("div",{class:"progress-bar bg-secondary",role:"progressbar",style:{width:"34%"},"aria-valuenow":"34","aria-valuemin":"0","aria-valuemax":"100"}," 完成訂單 ")],-1)),B={class:"row gy-4 flex-column-reverse flex-md-row"},N={class:"col-12 col-md-8"},q={class:"cartList d-flex flex-column border border-primary rounded"},R=o(()=>t("div",{class:"bg-primary fs-5 text-white mb-3 p-3 ps-4"},"訂購清單",-1)),M={class:"p-3"},O=["onClick"],Q=["onClick"],z={class:"card-body d-flex flex-column justify-content-around"},W={class:"d-flex mb-1 justify-content-between"},Y={key:0,class:"badge bg-danger mb-2"},G={class:"d-flex gap-1"},H=["onClick"],J={class:"card-title text-black fs-4"},K=o(()=>t("p",null,"750 ml",-1)),X={class:"input-group mb-3"},Z=o(()=>t("span",{class:"input-group-text"},"數量",-1)),tt=["onUpdate:modelValue","onClick"],et={class:"d-flex"},st={class:"text-danger"},it=o(()=>t("div",{class:"d-flex justify-content-center mt-3 mb-5"},[t("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),at={class:"d-flex flex-column align-items-end pe-3"},ot={key:0,class:"text-primary fs-5"},rt={key:1,class:"text-primary fs-5"},ct={class:"text-end mb-1"},nt={class:"fs-4"},lt={class:"col-12 col-md-4"},dt={class:"totalPrice"},ht={class:"card fs-5"},ut=o(()=>t("div",{class:"card-header bg-primary fs-5 p-3 ps-4 text-white"},"購物車",-1)),_t={class:"card-body"},pt={class:"d-flex justify-content-between"},vt=o(()=>t("p",{class:"card-text"},"商品小計",-1)),mt={class:"card-text"},ft={class:"d-flex justify-content-between"},gt=o(()=>t("p",{class:"card-text"},"運費價格",-1)),bt={class:"card-text"},xt={class:"d-flex justify-content-between"},yt=o(()=>t("p",{class:"card-text"},"優惠卷",-1)),wt={key:0,class:"card-text text-danger"},It={key:1,class:"card-text"},Ct=o(()=>t("div",{class:"d-flex justify-content-center"},[t("div",{class:"bg-black text-center line",style:{height:"1px"}})],-1)),kt={class:"card-body d-flex justify-content-between fw-bold"},Ft=o(()=>t("p",{class:"card-text"},"總計",-1)),St={class:"card-text text-danger fs-4"};function Lt(e,s,i,p,r,c){return l(),n("div",null,[E,t("div",U,[V,A,t("div",B,[t("div",N,[t("div",q,[R,t("div",M,[(l(!0),n(g,null,b(r.cart,(a,y)=>(l(),n("div",{class:"card shadow d-flex flex-row justify-content-between mb-3 fs-4 pe-3",key:y},[t("a",{href:"#",onClick:v(h=>c.toggleFavorite(a),["prevent"])},[t("i",{class:k(["bi heart position-absolute top-5 start-5",{"bi-heart":!a.isFavorite,"bi-heart-fill":a.isFavorite}])},null,2)],8,O),t("a",{href:"#",onClick:v(h=>c.seeProduct(a.product_id),["prevent"]),class:"wine_image_block"},[t("div",{class:"wine_image",style:F({"background-image":`${e.$filters.imgPath("url(/images/wine_images/"+a.image+".jpg)")}`})},null,4)],8,Q),t("div",z,[t("div",W,[a.is_hot?(l(),n("span",Y,"熱門推薦")):f("",!0),t("div",G,[(l(!0),n(g,null,b(a.star,h=>(l(),n("i",{class:"bi bi-star-fill text-warning",key:h}))),128))])]),t("a",{href:"#",onClick:v(h=>c.seeProduct(a.id),["prevent"])},[t("h5",J,d(a.chineseName),1)],8,H),K,t("div",X,[Z,S(t("input",{type:"number",min:"0",class:"form-control text-end","onUpdate:modelValue":h=>a.qty=h,onClick:v(h=>c.updateCartQty(a),["prevent"])},null,8,tt),[[L,a.qty,void 0,{number:!0}]])]),t("div",et,[t("p",st,"$ "+d(a.price),1)])])]))),128))]),it,t("div",at,[r.coupon?(l(),n("p",ot,"太棒了！訂單滿3000元，獲得免運！")):f("",!0),r.coupon?f("",!0):(l(),n("p",rt," 再 "+d(3e3-c.calculateSubtotal)+" 元即可獲得免運唷！ ",1)),t("div",null,[t("p",ct,"(共 "+d(r.cart.length)+" 件商品)",1),t("p",nt,"小計: NT$ "+d(c.calculateSubtotal)+" 元",1)])])])]),t("div",lt,[t("div",dt,[t("div",ht,[ut,t("div",_t,[t("div",pt,[vt,t("p",mt,"NT$ "+d(c.calculateSubtotal),1)]),t("div",ft,[gt,t("p",bt,"NT$ "+d(c.processedShipping),1)]),t("div",xt,[yt,r.coupon?(l(),n("p",wt,"- NT$ "+d(r.coupon.discount),1)):(l(),n("p",It,"沒有可用的優惠卷"))])]),Ct,t("div",kt,[Ft,t("p",St,"NT$ "+d(c.calculateTotalPrice)+" 元",1)]),t("a",{href:"#",class:"btn bg-primary-low text-white fs-5 py-3",onClick:s[0]||(s[0]=v((...a)=>c.toCheckoutPage&&c.toCheckoutPage(...a),["prevent"]))},"前往結帳頁面")])])])])])])}const Et=w(D,[["render",Lt],["__scopeId","data-v-111ee261"]]);export{Et as default};
