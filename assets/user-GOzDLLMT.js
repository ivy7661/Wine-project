import{P as n,g as o}from"./index-KDcbRjT1.js";import{S as i}from"./sweetalert2.all-edPz5k6j.js";import{a as c}from"./helpers-Hx-ZzB2u.js";const p=n("userStore",{state:()=>({user:null,carts:[],favorites:[]}),getters:{getUser:({user:e})=>e,getFavorites:({favorites:e})=>e||[],getCarts:({carts:e})=>e||[],getCartLength:({carts:e})=>e.length||0},actions:{setUser(e){this.user={...e},this.reGetAllData()},getUserCookie(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)userToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),t=document.cookie.replace(/(?:(?:^|.*;\s*)userId\s*=\s*([^;]*).*$)|^.*$/,"$1");return{userToken:e||null,userId:parseInt(t,10)||null}},reGetAllData(){this.resetUserFavorites(),this.resetUserCarts()},resetUserFavorites(){var e;(e=this.user)!=null&&e.id&&o.get(`https://wine-project-tmiy.onrender.com/favorite?userId=${this.user.id}`).then(t=>{this.favorites=t.data.map(s=>s.productId)}).catch(t=>{console.error(t.response)})},resetUserCarts(){var e;(e=this.user)!=null&&e.id&&o.get(`https://wine-project-tmiy.onrender.com/carts?userId=${this.user.id}`).then(t=>{this.carts=t.data}).catch(t=>{console.error(t.response)})},addToCart(e){var t;if(e!=null&&e.id&&((t=this.user)!=null&&t.id)){const s=this.carts.findIndex(r=>r.product_id===e.id&&r.userId===this.user.id);if(s>-1){const r=this.carts[s].id;this.carts[s].qty+=1;const a={qty:this.carts[s].qty};o.patch(`https://wine-project-tmiy.onrender.com/carts/${r}`,a).then(h=>{this.resetUserCarts(),i.fire({title:"成功加入購物車",text:"商品已經成功加入購物車",icon:"success"})}).catch(()=>{i.fire({title:"加入購物車失敗",text:"請稍後再試",icon:"error"})})}else{const r={product_id:e.id,chineseName:e.chineseName,image:e.image,price:e.price,is_hot:e.is_hot,star:e.star,qty:1,userId:parseInt(this.user.id,10)};o.post("https://wine-project-tmiy.onrender.com/carts",r).then(a=>{this.resetUserCarts(),i.fire({title:"成功加入購物車",text:"商品已經成功加入購物車",icon:"success"})}).catch(()=>{i.fire({title:"加入購物車失敗",text:"請稍後再試",icon:"error"})})}}},addToFavorite(e){o.post("https://wine-project-tmiy.onrender.com/favorite",e).then(t=>{this.resetUserFavorites(),i.fire({title:"收藏成功",text:"",icon:"success"})}).catch(()=>{i.fire({title:"收藏失敗",text:"",icon:"error"})})},setUserCookie(e,t){const s=c(new Date,2);document.cookie=`userToken=${t}; expires=${new Date(s)}; path=/`,document.cookie=`userId=${e}; expires=${new Date(s)}; path=/`},cleanUser(){this.user=null,document.cookie=`userToken=0; expires=${new Date("2000/1/1 12:00")}; path=/`,document.cookie=`userId=0; expires=${new Date("2000/1/1 12:00")}; path=/`}}});export{p as u};
