import{S as h}from"./sweetalert2.all-z-9cJw1m.js";import{_ as R,L as U,m as B,I as O,g as u,h as V,c as d,a as e,b as I,w as T,F as f,j as v,z as b,M as q,A as y,k as g,d as w,y as x,r as L,o as l,t as _,i as N,p as D,e as $,f as j}from"./index-6PzzfaJ8.js";import{u as C}from"./user-qX7th_-E.js";/* empty css              */import{W as P}from"./WineGlassLoader-yM45y1Ob.js";import{_ as E}from"./footerContainer-TBENB7Dp.js";import"./helpers-Hx-ZzB2u.js";var A={VITE_API_URL:"https://wine-project-tmiy.onrender.com",VITE_REPO_NAME:"Wine-project",BASE_URL:"/Wine-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:p}=A,M={name:"UserProductsView",data(){return{products:[],selectedRegion:"熱賣酒品",productsContent:"",currentSort:"",selectedRegionProducts:[],filteredProducts:[],cart:[],ascendingOrderPrice:!0,ascendingOrderStar:!0,searchKeyword:"",favoriteList:[],allFavoriteList:[],quantityOptions:[1,2,3,4,5,6,7,8,9,10],userId:"",isLoading:!1,fullPage:!0}},components:{Loading:U,WineGlassLoader:P},methods:{...B(C,["setUser","cleanUser","getUserCookie","resetUserCarts"]),doLoading(){this.$loading.show({props:{spinner:P},container:this.$refs.loadingContainer,canCancel:!0,color:"#000000",loader:"spinner",width:64,height:64,backgroundColor:"#ffffff",opacity:.5,zIndex:999},{default:O("WineGlassLoader")}).hide()},setLoadingTime(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},800)},getProductList(){const t=`${p}/products`;u.get(t).then(s=>{this.setLoadingTime(),this.products=s.data.map(n=>({...n,qty:1})),this.selectedRegionProducts=this.products.filter(n=>n.is_hot===1)}).catch(()=>{})},getCartList(){const t=`${p}/carts`;u.get(t).then(s=>{this.cart=s.data.filter(n=>n.userId===this.userId)}).catch(()=>{})},updateContent(t){const s=`${p}/productsContent`;u.get(s).then(n=>{this.productsContent=n.data}).catch(()=>{})},sortBy(t){t==="price"?this.ascendingOrderPrice=!this.ascendingOrderPrice:t==="star"&&(this.ascendingOrderStar=!this.ascendingOrderStar),this.currentSort=t},addToCart(t){if(!this.userId){h.fire({title:"請先登入",html:"前往登入頁面",icon:"question",showCancelButton:!0,cancelButtonText:"取消"}).then(r=>{r.isConfirmed&&this.goLogin()});return}const s=`${p}/carts`,n=this.cart.findIndex(r=>r.product_id===t.id&&r.userId===this.userId);if(n===-1){const r={product_id:t.id,chineseName:t.chineseName,image:t.image,price:t.price,is_hot:t.is_hot,star:t.star,qty:t.qty,userId:this.userId};u.post(s,r).then(i=>{this.resetUserCarts(),h.fire({title:"成功加入購物車",text:"商品已經成功加入購物車",icon:"success"})}).catch(()=>{h.fire({title:"加入購物車失敗",text:"請稍後再試",icon:"error"})})}else{const r=this.cart[n].id;this.cart[n].qty+=t.qty;const i={qty:this.cart[n].qty};u.patch(`${s}/${r}`,i).then(a=>{this.resetUserCarts(),h.fire({title:"成功加入購物車",text:"商品已經成功加入購物車",icon:"success"})}).catch(()=>{h.fire({title:"加入購物車失敗",text:"請稍後再試",icon:"error"})})}this.getCartList()},seeProduct(t){this.$router.push({name:"ProductDetail",params:{id:t}})},goLogin(){this.$router.push({name:"UserLogin"})},getFavoriteList(){const t=`${p}/favorite`;u.get(t).then(s=>{this.allFavoriteList=s.data,this.favoriteList=s.data.filter(n=>n.userId===this.userId),this.checkFavoriteStatus()}).catch(()=>{})},checkFavoriteStatus(){this.sortedProducts.forEach(t=>{t.isFavorite=this.isProductInFavorite(t.id)})},isProductInFavorite(t){return this.favoriteList.some(s=>s.productId===t)},addToFavorite(t){if(!this.userId){h.fire({title:"請先登入",html:"前往登入頁面",icon:"question",showCancelButton:!0,cancelButtonText:"取消"}).then(a=>{a.isConfirmed&&this.goLogin()});return}const s=`${p}/favorite`,n=new Date,r=`${n.getFullYear()}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")}`,i={userId:this.userId,productId:t,created_at:r};u.post(s,i).then(a=>{this.getFavoriteList(),h.fire({title:"加入最愛",text:"商品已經成功加入最愛清單。",icon:"success"})}).catch(()=>{})},toggleFavorite(t){this.isProductInFavorite(t.id)?this.removeFromFavorite(t.id):this.addToFavorite(t.id)},removeFromFavorite(t){if(!this.userId){h.fire({title:"請先登入",html:"前往登入頁面",icon:"question",showCancelButton:!0,cancelButtonText:"取消"}).then(i=>{i.isConfirmed&&this.goLogin()});return}const s=`${p}/favorite`,n=this.allFavoriteList.findIndex(i=>i.productId===t&&i.userId===this.userId),r=this.allFavoriteList[n].id;u.delete(`${s}/${r}`,{userId:this.userId,id:n}).then(i=>{this.getFavoriteList()}).catch(()=>{})}},computed:{...V(C,["getUser"]),sortedProducts(){let t=[];this.selectedRegion==="熱賣酒品"?t=this.products.filter(r=>r.is_hot===1):t=this.products.filter(r=>r.place===this.selectedRegion);const s=this.searchKeyword.trim();return s&&(t=t.filter(r=>r.chineseName.includes(s))),t.sort((r,i)=>this.currentSort==="price"?this.ascendingOrderPrice?r.price-i.price:i.price-r.price:this.currentSort==="star"?this.ascendingOrderStar?r.star-i.star:i.star-r.star:0)}},mounted(){const{userId:t}=this.getUserCookie();this.userId=t,this.getProductList(),this.getCartList(),this.updateContent(),this.getFavoriteList()}},m=t=>(D("data-v-a6850500"),t=t(),$(),t),W={class:"bg-products pb-4"},G={class:"container"},z={class:"row justify-content-between"},K={class:"col-lg-6"},Q={key:0},Y={class:"pb-5 text-white"},H={class:"text-white lh-large fs-5 font-monospace"},J={class:"col-12 col-lg-5 d-flex flex-column justify-content-end"},X={class:"searchArea mx-3"},Z=m(()=>e("i",{class:"bi bi-search"},null,-1)),tt={class:"filterBox mx-3"},et=m(()=>e("label",{for:"wineRegion",class:"text-white fs-5 pb-1"},"請選擇產區:",-1)),st=j('<option value="" disabled selected hidden data-v-a6850500>產區: 請選擇產區</option><option value="波爾多" data-v-a6850500>波爾多</option><option value="布根地" data-v-a6850500>布根地</option><option value="香檳" data-v-a6850500>香檳</option><option value="羅亞爾河谷" data-v-a6850500>羅亞爾河谷</option><option value="薄酒萊" data-v-a6850500>薄酒萊</option><option value="熱賣酒品" data-v-a6850500>熱賣酒品</option>',7),it=[st],ot={class:"filterBtn d-flex justify-content-between gap-3"},rt={class:"container"},nt=m(()=>e("img",{src:E,class:"w-100 mb-5",alt:"line"},null,-1)),at={class:"productList pb-5 align-items-stretch"},ct={class:"row mb-3 gy-3"},dt=["onClick"],lt={href:"#",class:"card h-100 p-3 product_card radius-24"},ht={class:"row h-100 d-flex"},ut={class:"col-4"},pt=["onClick"],gt={href:"#"},_t=["src","alt"],ft={class:"col-8"},vt={class:"card-body d-flex flex-column h-100 justify-content-evenly"},mt={class:"mb-2"},bt={class:"card-title flex-fill"},wt={class:"card-subtitle mt-2 text-secondary"},xt={class:"d-flex mb-2 justify-content-between"},It={class:"d-flex gap-1"},yt={class:"text-primary fw-bold"},Lt={class:"row"},Ct={class:"col"},Pt=["onUpdate:modelValue"],Ft=["value"],St={class:"col"},kt=["onClick"],Rt=m(()=>e("i",{class:"bi bi-arrow-right"},null,-1));function Ut(t,s,n,r,i,a){const F=L("WineGlassLoader"),S=L("Loading");return l(),d("div",null,[e("div",W,[I(S,{active:i.isLoading,"onUpdate:active":s[0]||(s[0]=o=>i.isLoading=o),"is-full-page":i.fullPage},{default:T(()=>[I(F)]),_:1},8,["active","is-full-page"]),e("div",G,[e("div",z,[e("div",K,[(l(!0),d(f,null,v(i.productsContent,o=>(l(),d("div",{class:"px-3",key:o.title},[i.selectedRegion===o.title?(l(),d("div",Q,[e("h2",Y,"法國五大產區 - "+_(o.title),1),e("p",H,_(o.content),1)])):N("",!0)]))),128))]),e("div",J,[e("div",X,[Z,b(e("input",{type:"text",placeholder:"請輸入關鍵字",class:"w-100 fs-5","onUpdate:modelValue":s[1]||(s[1]=o=>i.searchKeyword=o)},null,512),[[q,i.searchKeyword]])]),e("div",tt,[et,b(e("select",{id:"wineRegion",name:"wineRegion",class:"mb-3 fs-5","onUpdate:modelValue":s[2]||(s[2]=o=>i.selectedRegion=o),onChange:s[3]||(s[3]=o=>a.updateContent(i.selectedRegion))},it,544),[[y,i.selectedRegion]]),e("div",ot,[e("a",{type:"button",class:"btn btn-primary btn-lg px-4 py-2",onClick:s[4]||(s[4]=g(o=>a.sortBy("price"),["prevent"]))},[w(" 價格 "),e("i",{class:x(i.ascendingOrderPrice?"bi bi-arrow-down":"bi bi-arrow-up")},null,2)]),e("a",{type:"button",class:"btn btn-primary btn-lg px-4 py-2 me-0",onClick:s[5]||(s[5]=g(o=>a.sortBy("star"),["prevent"]))},[w(" 評價 "),e("i",{class:x(i.ascendingOrderStar?"bi bi-arrow-down":"bi bi-arrow-up")},null,2)])])])])])])]),e("div",rt,[nt,e("div",at,[e("div",ct,[(l(!0),d(f,null,v(a.sortedProducts,(o,k)=>(l(),d("a",{class:"col-12 col-md-6",key:k,onClick:g(c=>a.seeProduct(o.id),["prevent"])},[e("a",lt,[e("div",ht,[e("div",ut,[e("div",null,[e("a",{href:"#",onClick:g(c=>a.toggleFavorite(o),["prevent","stop"])},[e("i",{class:x(["bi heart position-absolute top-5 start-5",{"bi-heart":!o.isFavorite,"bi-heart-fill":o.isFavorite}])},null,2)],8,pt),e("a",gt,[e("img",{src:t.$filters.imgPath(`/images/wine_images/${o.image}.jpg`),class:"card-img-top h-100 radius-24",alt:o.chineseName},null,8,_t)])])]),e("div",ft,[e("div",vt,[e("div",null,[e("div",mt,[e("h5",bt,_(o.chineseName),1),e("h6",wt,_(o.englishName),1)])]),e("div",xt,[e("div",It,[(l(!0),d(f,null,v(o.star,c=>(l(),d("i",{class:"bi bi-star-fill text-warning",key:c}))),128))])]),e("h5",yt,"$ "+_(o.price),1),e("div",Lt,[e("div",Ct,[e("div",{class:"input-group mb-3",onClick:s[6]||(s[6]=g(()=>{},["prevent","stop"]))},[b(e("select",{class:"form-select","onUpdate:modelValue":c=>o.qty=c},[(l(!0),d(f,null,v(i.quantityOptions,c=>(l(),d("option",{key:c,value:c},_(c),9,Ft))),128))],8,Pt),[[y,o.qty]])])]),e("div",St,[e("a",{href:"#",class:"btn btn-primary px-3 radius-24",onClick:g(c=>a.addToCart(o),["prevent","stop"])},[w("加入購物車 "),Rt],8,kt)])])])])])])],8,dt))),128))])])])])}const $t=R(M,[["render",Ut],["__scopeId","data-v-a6850500"]]);export{$t as default};
